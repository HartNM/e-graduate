import{t as n,j as e,B as k,T as A,v as B,D as T,E as z,A as r}from"./index-B7_hvkM2.js";import{u as p,w as $}from"./xlsx-mxuUxWRI.js";import{S as O}from"./PdfPrintExam-BD-EPQ_H.js";import{M as F}from"./ModalInform-NNINQB9X.js";import{G as x}from"./Group-dxvsYpX2.js";import{B as L}from"./Button-fInQYk36.js";import{S as P}from"./Space-CyCyKMgB.js";import"./PdfUtils-2D7kTCyc.js";import"./dayjs.min-TNDP4t9g.js";/* empty css                    */import"./createReactComponent-DJN_V7q0.js";const w="http://localhost:8080",Y=()=>{const[m,f]=n.useState({open:!1,type:"",message:""}),j=(t,s)=>f({open:!0,type:t,message:s}),y=()=>f(t=>({...t,open:!1})),g=localStorage.getItem("token"),[E,q]=n.useState([]),[c,_]=n.useState(""),[h,b]=n.useState("");n.useEffect(()=>{(async()=>{try{const s=await fetch(`${w}/api/allRequestExamInfo`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`}}),o=await s.json();if(!s.ok)throw new Error(o.message);q(o.map(i=>i.term)),console.log(o);const l=new Date;let a=o.find(i=>{const u=new Date(i.term_open_date),I=new Date(i.term_close_date);return l>=u&&l<=I});!a&&o.length>0&&(a=[...o].sort((i,u)=>new Date(u.term_close_date)-new Date(i.term_close_date))[0]),a?_(a.term):console.warn("ไม่พบข้อมูลเทอม")}catch(s){j("error",s.message),console.error("Error fetching allRequestExamInfo:",s)}})()},[]);const[D,R]=n.useState([]);n.useEffect(()=>{if(!c)return;console.log(c),(async()=>{try{const s=await fetch(`${w}/api/requestExamAll`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify({term:c})}),o=await s.json();if(!s.ok)throw new Error(o.message);R(o),console.log("all request :",o)}catch(s){j("error",s.message),console.error("Error fetching requestExamAll:",s)}})()},[c]);const[S,C]=n.useState(""),d=D.filter(t=>{const s=t.status==="5",o=[t.student_name,t.student_id].join(" ").toLowerCase().includes(S.toLowerCase()),l=h?t.request_type===h:!0;return s&&o&&l}),v=()=>{const t=d.map(a=>({รหัสนักศึกษา:a.student_id,"ชื่อ-สกุล":a.student_name,คำขอ:a.request_type,สาขาวิชา:a.major_name,ระดับการศึกษา:a.education_level})),s=p.json_to_sheet(t),o=p.book_new();p.book_append_sheet(o,s,"StudentsData");const l=`รายชื่อผู้มีสิทธิสอบประมวลความรู้_วัดคุณสมบัติ_${c}.xlsx`;$(o,l)};return e.jsxs(k,{children:[e.jsx(F,{opened:m.open,onClose:y,message:m.message,type:m.type}),e.jsx(A,{size:"1.5rem",fw:900,mb:"md",children:"พิมพ์ใบรายชื่อผู้มีสิทธิสอบประมวลความรู้/วัดคุณสมบัติ"}),e.jsxs(x,{justify:"space-between",children:[e.jsxs(x,{children:[e.jsx(B,{placeholder:"ค้นหา ชื่่อ รหัส",value:S,onChange:t=>C(t.target.value)}),e.jsx(T,{placeholder:"ชนิดคำขอ",data:["ขอสอบประมวลความรู้","ขอสอบวัดคุณสมบัติ"],value:h,onChange:b}),e.jsx(T,{placeholder:"เทอมการศึกษา",data:E,value:c,allowDeselect:!1,onChange:_})]}),e.jsxs(x,{children:[e.jsx(L,{size:"xs",color:"green",onClick:v,disabled:d.length===0,children:"Export Excel"}),e.jsx(O,{data:d})]})]}),e.jsx(P,{h:"md"}),e.jsx(z,{type:"scroll",offsetScrollbars:!0,style:{borderRadius:"8px",border:"1px solid #e0e0e0"},children:e.jsxs(r,{horizontalSpacing:"sm",verticalSpacing:"sm",highlightOnHover:!0,children:[e.jsx(r.Thead,{children:e.jsxs(r.Tr,{children:[e.jsx(r.Th,{children:"รหัสนักศึกษา"}),e.jsx(r.Th,{children:"ชื่อ"}),e.jsx(r.Th,{children:"คำขอ"})]})}),e.jsx(r.Tbody,{children:d.map(t=>e.jsxs(r.Tr,{children:[e.jsx(r.Td,{children:t.student_id}),e.jsx(r.Td,{children:t.student_name}),e.jsx(r.Td,{children:t.request_type})]},t.request_exam_id))})]})})]})};export{Y as default};
