import{t as i,j as t,B as S,T as g,D as _,E,A as o}from"./index-B7_hvkM2.js";import{P as b}from"./PdfExamResultsPrint-DlwH8fCD.js";import{G as x}from"./Group-dxvsYpX2.js";import{S as D}from"./Space-CyCyKMgB.js";import{B as P}from"./Button-fInQYk36.js";import"./PdfUtils-2D7kTCyc.js";import"./dayjs.min-TNDP4t9g.js";const u="http://localhost:8080",O=()=>{const d=localStorage.getItem("token"),[j,f]=i.useState([]),[T,y]=i.useState([]),[c,m]=i.useState(""),h=s=>{const[e,r]=s.split("/").map(Number);return r*10+e};return i.useEffect(()=>{(async()=>{try{const e=await fetch(`${u}/api/allRequestExamInfo`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}}),r=await e.json();if(!e.ok)throw new Error(r.message);y(r.map(a=>a.term));const p=new Date;let n=r.find(a=>{const l=new Date(a.term_open_date),w=new Date(a.term_close_date);return p>=l&&p<=w});!n&&r.length>0&&(n=[...r].sort((a,l)=>new Date(l.term_close_date)-new Date(a.term_close_date))[0]),n&&m(n.term)}catch(e){notify("error",e.message)}try{const e=await fetch(`${u}/api/allExamProposalResultsPrint`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}}),r=await e.json();if(!e.ok)throw new Error(r.message);f(r)}catch(e){notify("error",e.message)}})()},[]),t.jsxs(S,{children:[t.jsx(g,{size:"1.5rem",fw:900,mb:"md",children:"พิมพ์ผลการสอบโครงร่างวิทยานิพนธ์/การค้นคว้าอิสระ"}),t.jsx(x,{justify:"space-between",children:t.jsx(x,{children:t.jsx(_,{placeholder:"เทอมการศึกษา",data:T,value:c,onChange:m})})}),t.jsx(D,{h:"md"}),t.jsx(E,{type:"scroll",offsetScrollbars:!0,style:{borderRadius:"8px",border:"1px solid #e0e0e0"},children:t.jsxs(o,{horizontalSpacing:"sm",verticalSpacing:"sm",highlightOnHover:!0,children:[t.jsx(o.Thead,{children:t.jsxs(o.Tr,{children:[t.jsx(o.Th,{children:"รหัสหมู่เรียน"}),t.jsx(o.Th,{children:"เทอมการศึกษา"}),t.jsx(o.Th,{children:"คำขอ"}),t.jsx(o.Th,{children:"ดำเนินการ"})]})}),t.jsx(o.Tbody,{children:Object.entries(j.filter(s=>!c||s.term===c).sort((s,e)=>h(e.term)-h(s.term)).reduce((s,e)=>{const r=`${e.study_group_id}-${e.term}`;return s[r]||(s[r]=[]),s[r].push(e),s},{})).map(([s,e])=>t.jsxs(o.Tr,{children:[t.jsx(o.Td,{children:e[0].study_group_id}),t.jsx(o.Td,{children:e[0].term}),t.jsx(o.Td,{children:[...new Set(e.map(r=>r.request_type))].join(", ")}),t.jsx(o.Td,{children:t.jsx(P,{size:"xs",onClick:()=>b(e),children:"พิมพ์"})})]},s))})]})})]})};export{O as default};
