import{t as o,j as e,A as r,B as C,M as N,T as E,v as P,D as L,E as V}from"./index-B7_hvkM2.js";/* empty css                    */import{u as G}from"./use-form-DDBi_7fX.js";import{G as H}from"./Group-dxvsYpX2.js";import{B as j}from"./Button-fInQYk36.js";import{S as x}from"./Space-CyCyKMgB.js";import{F as q}from"./Flex-CXnzITNo.js";const u="http://localhost:8080",ee=()=>{const[J,w]=o.useState({open:!1,type:"",message:""}),h=(s,a)=>w({open:!0,type:s,message:a}),[A,d]=o.useState(!1),[m,g]=o.useState(!1),[i,F]=o.useState(null),[D,T]=o.useState(!1),p=localStorage.getItem("token"),[M,$]=o.useState([]),[b,S]=o.useState([]),[v,O]=o.useState([]),[_,y]=o.useState(!1),l=G({initialValues:{user_id:"",name:"",major_id:"",password:"123456"},validate:{name:s=>s.trim().length>0?null:"กรุณากรอกชื่อ"}});o.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${u}/api/getMajor_name`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`}})).json();F(n),console.log("EFFECT (Table) - major:",n);const c=await fetch(`${u}/api/allAssignChairpersons`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`}}),t=await c.json();if(!c.ok)throw new Error(t.message);console.log("EFFECT (Table) - Chairpersons (Assigned):",t),O(t);const f=t.filter(I=>I.major_id===n.major_id);$(f),console.log("EFFECT (Table) - Chairpersons filtered (This Major):",f)}catch(a){h("error",a.message),console.error("Error fetch Table Data:",a)}T(!1)})()},[D,p]);const R=async()=>{l.reset(),g("add"),d(!0),y(!0),S([]);try{if(!i||!i.id_fac)throw new Error("ยังโหลดข้อมูลสาขาไม่เสร็จ หรือไม่มี id_fac");const s=await fetch(`https://git.kpru.ac.th/FrontEnd_Admission/admissionnew2022/loadMember/${i.id_fac}`),a=await s.json();if(!s.ok)throw new Error("ไม่สามารถดึงข้อมูลบุคลากรได้");const c=a.map(t=>({value:t.employee_id,label:`${t.prename_full_tha}${t.first_name_tha} ${t.last_name_tha}`.trim()})).filter(t=>!v.some(f=>f.user_id===t.value));S(c),console.log("HANDLE OPEN ADD - Candidates for Select:",c)}catch(s){h("error",s.message),console.error("Error fetching data for select:",s),d(!1)}finally{y(!1)}},k=s=>{l.setValues(s),g("delete"),d(!0)},B=async()=>{const s={add:`${u}/api/addAssignChairpersons`,delete:`${u}/api/deleteAssignChairpersons`};try{const a=await fetch(s[m],{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify({...l.values,major_id:i.major_id})}),n=await a.json();if(!a.ok)throw new Error(n.message);h("success",n.message),T(!0),d(!1)}catch(a){h("error",a.message),console.error("Error fetch AssignChairpersons:",a)}},z=M.map(s=>e.jsxs(r.Tr,{children:[e.jsx(r.Td,{children:i?.major_name}),e.jsx(r.Td,{children:s.name}),e.jsx(r.Td,{children:e.jsx(H,{children:e.jsx(j,{color:"red",size:"xs",onClick:()=>k(s),children:"ลบ"})})})]},s.user_id));return e.jsxs(C,{children:[e.jsx(N,{opened:A,onClose:()=>d(!1),title:"กรอกข้อมูลประธานกรรมการบัณฑิตศึกษาประจำสาขาวิชา",centered:!0,children:e.jsxs("form",{onSubmit:l.onSubmit(B),children:[e.jsxs(E,{children:["สาขา",i?.major_name]}),m==="delete"?e.jsx(P,{label:"ชื่อ",...l.getInputProps("name"),disabled:!0}):e.jsx(e.Fragment,{children:e.jsx(L,{label:"ชื่อ",searchable:!0,data:b,value:l.values.user_id,onChange:s=>{l.setFieldValue("user_id",s);const a=b.find(n=>n.value===s);l.setFieldValue("name",a?a.label:"")},disabled:_,placeholder:_?"กำลังโหลดรายชื่อ...":"เลือกอาจารย์"})}),e.jsx(x,{h:"md"}),e.jsx(j,{color:m==="delete"?"red":"green",type:"submit",fullWidth:!0,children:m==="delete"?"ลบ":"บันทึก"})]})}),e.jsx(E,{size:"1.5rem",fw:900,mb:"md",children:"กรอกข้อมูลประธานกรรมการบัณฑิตศึกษาประจำสาขาวิชา"}),e.jsx(x,{h:"xl"}),e.jsx(C,{children:e.jsx(q,{justify:"flex-end",children:e.jsx(j,{variant:"filled",size:"xs",onClick:()=>R(),disabled:!i,children:"เพิ่มข้อมูล"})})}),e.jsx(x,{h:"xl"}),e.jsx(V,{type:"scroll",offsetScrollbars:!0,style:{borderRadius:"8px",border:"1px solid #e0e0e0"},children:e.jsxs(r,{horizontalSpacing:"sm",verticalSpacing:"sm",highlightOnHover:!0,children:[e.jsx(r.Thead,{children:e.jsxs(r.Tr,{children:[e.jsx(r.Th,{children:"สาขา"}),e.jsx(r.Th,{children:"อาจารย์"}),e.jsx(r.Th,{children:"การดำเนินการ"})]})}),e.jsx(r.Tbody,{children:z})]})})]})};export{ee as default};
