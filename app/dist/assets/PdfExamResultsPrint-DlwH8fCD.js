import{P as I,f as j,s as O,a as T,d as P,e as q,h as x,i as l,j as u}from"./PdfUtils-2D7kTCyc.js";const S="http://localhost:8080";async function k(o){const s=await I.create();s.registerFontkit(j);const y=s.addPage([595,842]),r=await O(s),b=await fetch("/icons/KPRU-LOGO-line2.png").then(e=>e.arrayBuffer()),R=await s.embedPng(b),$=R.scale(.125),_=25,a=20;let d=0,p=`ประจำภาคเรียนที่ ${o[0].term}`;if(o[0].request_type==="ขอสอบประมวลความรู้"||o[0].request_type==="ขอสอบวัดคุณสมบัติ")try{const e=localStorage.getItem("token"),i=await(await fetch(`${S}/api/allRequestExamInfo`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({term:o[0].term})})).json();if(Array.isArray(i)&&i.length>0){const w=i[0],h=w.KQ_exam_date,t=w.KQ_exam_end_date;if(h){const[n,c,f]=T(h);if(t&&t!==h){const[g,D,E]=T(t);c===D&&f===E?p+=` สอบวันที่ ${n} - ${g} ${c} ${f}`:p+=` สอบวันที่ ${n} ${c} ${f} - ${g} ${D} ${E}`}else p+=` สอบวันที่ ${n} ${c} ${f}`}}}catch(e){console.error("Error fetch allRequestExamInfo:",e)}for(;d*_<o.length;){const e=d===0?y:s.addPage([595,842]),m=d*_,i=Math.min(m+_,o.length),w=(e.getWidth()-$.width)/2;e.drawImage(R,{x:w,y:700,width:$.width,height:$.height});const h=o[0].request_type.split("ขอ")[1];let t=600;P(e,`ผล${h}`,680,r,16),P(e,`สาขาวิชา${o[0].major_name}`,660,r,16),P(e,p,640,r,16),q(e,60,t,490,a),x(e,100,t+a,100,t-(i-m)*a),x(e,230,t+a,230,t-(i-m)*a),x(e,440,t+a,440,t-(i-m)*a),l(e,"ลำดับ",60,t,40,a,r,14),l(e,"รหัสนักศึกษา",100,t,130,a,r,14),l(e,"ชื่อ - นามสกุล",230,t,210,a,r,14),l(e,"ผลการสอบ",440,t,110,a,r,14);for(let n=m;n<i;n++){t-=a,q(e,60,t,490,a),l(e,`${n+1}`,60,t,40,a,r,14),l(e,`${o[n].student_id}`,100,t,130,a,r,14);const c=o[n].name?o[n].name.split(/\s+/).filter(Boolean):["",""],f=c[0]||"",g=c.slice(1).join(" ");u(e,f,260,t,a,r,14),u(e,g,350,t,a,r,14),o[n].exam_results!==null&&o[n].exam_results!==void 0&&l(e,o[n].exam_results,440,t,110,a,r,14)}d++}const B=await s.save();return new Blob([B],{type:"application/pdf"})}async function F(o){console.log("ข้อมูลที่จะพิมพ์:",o);try{const s=await k(o),y=URL.createObjectURL(s);window.open(y,"_blank")}catch(s){console.error("เกิดข้อผิดพลาดสร้าง PDF:",s)}}export{F as P};
