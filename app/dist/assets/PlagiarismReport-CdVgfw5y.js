import{t as n,z as X,j as s,A as i,B as S,T as Y,v as Z,E as ee}from"./index-B7_hvkM2.js";import{M as te}from"./ModalAddPlagiarismReport-D0HZqbGm.js";import{M as se}from"./ModalApprove-GxzTwETF.js";import{M as re}from"./ModalInform-NNINQB9X.js";import{P as oe}from"./Pdfg01-C0u_maH6.js";import{u as ae}from"./use-form-DDBi_7fX.js";import{S as b}from"./Stepper-B-uTcAaD.js";import{P as w}from"./Pill-B7ktLfj6.js";import{G as v}from"./Group-dxvsYpX2.js";import{B as P}from"./Button-fInQYk36.js";import{F as ne}from"./Flex-CXnzITNo.js";import{S as ie}from"./Space-CyCyKMgB.js";import"./Grid-C85KIsm1.js";import"./get-sorted-breakpoints-BmTdo-hw.js";import"./DatePickerInput-DIAi7llo.js";import"./dayjs.min-TNDP4t9g.js";import"./use-disclosure-f2FIm-Gp.js";import"./Checkbox-BOck0Pse.js";/* empty css                    */import"./createReactComponent-DJN_V7q0.js";import"./PdfUtils-2D7kTCyc.js";const d="http://localhost:8080",$e=()=>{const l=localStorage.getItem("token"),C=l.split(".")[1],c=JSON.parse(atob(C)).role,[m,T]=n.useState({open:!1,type:"",message:""}),p=(e,t)=>T({open:!0,type:e,message:t}),q=()=>T(e=>({...e,open:!1})),[O,g]=n.useState(!1),[k,_]=n.useState(!1),[B,D]=n.useState(!1),[le,pe]=n.useState(!1),[$,z]=n.useState(null),[x,A]=n.useState("approve"),[j,R]=n.useState(""),[I,F]=n.useState(""),[de,M]=n.useState(""),[N,y]=n.useState([]),[E,L]=n.useState(""),{type:he}=X(),G=e=>e===null||e===""?"ห้ามเว้นว่าง":e<0||e>100?"กรอก 0-100 เท่านั้น":null,W={ขอสอบโครงร่างวิทยานิพนธ์:"โครงร่าง",ขอสอบโครงร่างการค้นคว้าอิสระ:"โครงร่าง",ขอสอบวิทยานิพนธ์:"",ขอสอบการค้นคว้าอิสระ:""},h=ae({initialValues:{student_name:"",study_group_id:"",student_id:"",education_level:"",program:"",major_name:"",faculty_name:"",research_name:"",chapter_1:null,chapter_2:null,chapter_3:null,chapter_4:null,chapter_5:null,inspection_date:null,plagiarism_file:null,full_report_file:null},validate:e=>{const t={};(e.research_name||"").trim()||(t.research_name="กรุณากรอกชื่อวิจัย"),e.inspection_date||(t.inspection_date="กรุณาระบุวันที่ปิด");let r=[];return e.request_type?W[e.request_type]==="โครงร่าง"&&(r=["chapter_1","chapter_2","chapter_3"]):r=["chapter_1","chapter_2","chapter_3","chapter_4","chapter_5"],r.forEach(o=>{const a=G(e[o]);a&&(t[o]=a)}),e.plagiarism_file instanceof File||(t.plagiarism_file="กรุณาอัปโหลดไฟล์ตรวจสอบ"),e.full_report_file instanceof File||(t.full_report_file="กรุณาอัปโหลดไฟล์รายงานฉบับเต็ม"),t}});n.useEffect(()=>{(async()=>{try{const t=await fetch(`${d}/api/profile`,{method:"GET",headers:{Authorization:`Bearer ${l}`}}),r=await t.json();if(!t.ok)throw new Error(r.message);M(r),console.log(r)}catch(t){p("error",t.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),console.error("Error fetching profile:",t)}})()},[l]);const[f,u]=n.useState(null);n.useEffect(()=>{(async()=>{try{const t=await fetch(`${d}/api/AllPlagiarismReport`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}}),r=await t.json();if(!t.ok)throw new Error(r.message);const o=await fetch(`${d}/api/buttonCheck`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}}),a=await o.json();if(console.log(a),!o.ok)throw new Error(a.message);console.log(r),y(r),a.length==1?r.length==2?u(r[0]):u(!1):(u(r[0]),console.log(!1))}catch(t){p("error",t.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),console.error("Error fetching AllPlagiarismReport:",t)}})()},[]);const J=async()=>{try{const e=await fetch(`${d}/api/studentInfo`,{method:"GET",headers:{Authorization:`Bearer ${l}`}}),t=await e.json();if(!e.ok)throw new Error(t.message);const r=await fetch(`${d}/api/openCheckThesis`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}}),o=await r.json();if(!r.ok)throw new Error(o.message);console.log(o),h.reset(),h.setValues({...t,...o}),console.log({...t,...o}),g(!0)}catch(e){p("error",e.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),console.error("Error fetching studentInfo:",e)}},U=async()=>{console.log(h.values);try{const e=new FormData;Object.entries(h.values).forEach(([o,a])=>{a instanceof Date?e.append(o,a.toISOString()):a instanceof File?e.append(o,a,a.name):e.append(o,a??"")});const t=await fetch(`${d}/api/addPlagiarismReport`,{method:"POST",headers:{Authorization:`Bearer ${l}`},body:e}),r=await t.json();if(!t.ok)throw new Error(r.message);p("success",r.message),u(!1),g(!1),y(o=>[...o,{...h.values,...r.data}])}catch(e){p("error",e.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),console.error("Error fetching addPlagiarismReport:",e)}},V=async e=>{if(x==="noapprove"&&j.trim()===""){F("กรุณาระบุเหตุผล");return}try{const t=await fetch(`${d}/api/approvePlagiarismReport`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({plagiarism_report_id:e.plagiarism_report_id,selected:x,comment:j})}),r=await t.json();if(!t.ok)throw new Error(r.message);p("success",r.message),A("approve"),R(""),_(!1),y(o=>o.map(a=>a.plagiarism_report_id===e.plagiarism_report_id?{...a,...r.data}:a))}catch(t){p("error",t.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),console.error("Error fetching approvePlagiarismReport:",t)}};function H(e,t){return t==="student"?e:e.sort((r,o)=>{const a=Number(r.status)===0?1:0,Q=Number(o.status)===0?1:0;return a-Q||Number(r.status)-Number(o.status)})}const K=H(N,c).filter(e=>[e.student_name,e.student_id].join(" ").toLowerCase().includes(E.toLowerCase())).map(e=>s.jsxs(i.Tr,{children:[s.jsx(i.Td,{children:e.student_name}),s.jsx(i.Td,{children:e.request_thesis_type.replace("ขอสอบ","")}),s.jsxs(i.Td,{style:{textAlign:"center"},children:[e.status<=4&&e.status>0&&s.jsx(b,{active:e.status-1,iconSize:20,styles:{separator:{marginLeft:-4,marginRight:-4},stepIcon:{fontSize:10}},children:[...Array(2)].map((t,r)=>s.jsx(b.Step,{children:s.jsx(w,{children:e.status_text})},r))}),e.status==5&&s.jsx(w,{variant:"filled",style:{backgroundColor:"#ccffcc",color:"#006600"},children:e.status_text}),e.status==6&&s.jsxs(s.Fragment,{children:[s.jsx(w,{variant:"filled",style:{backgroundColor:"#ffcccc",color:"#b30000"},children:e.status_text}),s.jsx("br",{}),!e.advisor_approvals&&"อาจารย์ที่ปรึกษา",e.advisor_approvals&&!e.chairpersons_approvals&&"ประธานหลักสูตร"]})]}),s.jsx(i.Td,{style:{maxWidth:"150px"},children:s.jsxs(v,{children:[s.jsx(oe,{data:e,showType:e.status==0?void 0:c==="advisor"&&e.status<=1||c==="chairpersons"&&e.status<=2||c==="officer_registrar"&&e.status<=3?"view":void 0}),(c==="advisor"&&e.status==1||c==="chairpersons"&&e.status==2||c==="officer_registrar"&&e.status==3)&&s.jsx(P,{size:"xs",color:"green",onClick:()=>{z(e),D("add"),_(!0)},children:"ลงความเห็น"})]})})]},e.plagiarism_report_id));return s.jsxs(S,{children:[s.jsx(re,{opened:m.open,onClose:q,message:m.message,type:m.type}),s.jsx(se,{opened:k,onClose:()=>_(!1),selectedRow:$,selected:x,setSelected:A,comment:j,setComment:R,error:I,openApproveState:B,handleApprove:V,role:c,title:"ลงความเห็นรายงานผลการตรวจสอบการคัดลอกผลงานทางวิชาการ"}),s.jsx(te,{opened:O,onClose:()=>g(!1),form:h,handleAdd:U,title:"เพิ่มรายงานผลการตรวจสอบการคัดลอกผลงานทางวิชาการ"}),s.jsx(Y,{size:"1.5rem",fw:900,mb:"md",children:"รายงานผลการตรวจสอบการคัดลอกผลงานทางวิชาการ"}),s.jsxs(v,{justify:"space-between",children:[s.jsx(S,{children:s.jsx(ne,{align:"flex-end",gap:"sm",children:c!=="student"&&s.jsx(Z,{placeholder:"ค้นหาชื่่อ รหัส",value:E,onChange:e=>L(e.target.value)})})}),s.jsx(S,{children:c==="student"&&s.jsx(P,{onClick:()=>J(),disabled:f?f.status!=="0"&&f.status!=="6"&&f.exam_results!==!1:!1,children:"เพิ่มคำร้อง"})})]}),s.jsx(ie,{h:"md"}),s.jsx(ee,{type:"scroll",offsetScrollbars:!0,style:{borderRadius:"8px",border:"1px solid #e0e0e0"},children:s.jsxs(i,{horizontalSpacing:"sm",verticalSpacing:"sm",highlightOnHover:!0,children:[s.jsx(i.Thead,{children:s.jsxs(i.Tr,{children:[s.jsx(i.Th,{style:{minWidth:100},children:"ชื่อ"}),s.jsx(i.Th,{style:{minWidth:100},children:"ชนิด"}),s.jsx(i.Th,{style:{minWidth:110},children:"สถานะ"}),s.jsx(i.Th,{children:"การดำเนินการ"})]})}),s.jsx(i.Tbody,{children:K})]})})]})};export{$e as default};
