import{j as A}from"./index-B7_hvkM2.js";import{P as S,f as k,a as C,d as c,e as E,h as D,i as d,j as K}from"./PdfUtils-2D7kTCyc.js";import{B as H}from"./Button-fInQYk36.js";const U="http://localhost:8080";async function G(l,g){const $=await fetch(l).then(a=>a.arrayBuffer()),w=await S.load($);w.registerFontkit(k);const m=await S.create();m.registerFontkit(k);const q=await fetch("/fonts/THSarabunNew.ttf").then(a=>a.arrayBuffer()),e=await m.embedFont(q),F=await fetch("/icons/KPRU-LOGO-line2.png").then(a=>a.arrayBuffer()),P=await m.embedPng(F),b=P.scale(.125),L=g?.[0]?.term,T=g.reduce((a,r)=>{const s=r.study_group_id;return a[s]||(a[s]=[]),a[s].push(r),a},{});let i=null;try{const a=localStorage.getItem("token"),s=await(await fetch(`${U}/api/allRequestExamInfo`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({term:L})})).json();Array.isArray(s)&&s.length>0&&(i=s[0]),console.log(i)}catch(a){console.error("Error fetch allRequestExamInfo:",a)}const h=[];if(i&&i.KQ_exam_date&&i.KQ_exam_end_date){const a=new Date(i.KQ_exam_date),r=new Date(i.KQ_exam_end_date);let s=new Date(a.getTime());for(;s<=r;)h.push(new Date(s)),s.setDate(s.getDate()+1)}else i&&i.KQ_exam_date&&h.push(new Date(i.KQ_exam_date));h.length===0&&h.push(null);const B=25,o=20;for(const a in T){const r=T[a];for(const s of h){let _;if(s){const[t,u,y]=C(s);_=`สอบวันที่ ${t} ${u} ${y} เวลา............................`}else _="สอบวันที่ ........................................ เวลา............................";let I=0;for(;I*B<r.length;){const[t]=await m.copyPages(w,[0]);m.addPage(t);const u=I*B,y=Math.min(u+B,r.length),O=(t.getWidth()-b.width)/2;t.drawImage(P,{x:O,y:700,width:b.width,height:b.height});const f=r[0],R=f.request_type.split("ขอ")[1],j=`${f.program.split(" (")[0]} สาขาวิชา${f.major_name}`;parseInt(f.student_id.slice(0,2),10)-57;let n;R==="สอบประมวลความรู้"?(c(t,`รายชื่อผู้เข้า${R}`,680,e,16),c(t,j,660,e,16),c(t,`ประจำภาคเรียนที่ ${f.term}`,640,e,16),c(t,"หมวด..........................................",620,e,16),c(t,_,600,e,16),n=560):(c(t,`รายชื่อผู้เข้า${R}`,680,e,16),c(t,j,660,e,16),c(t,`ประจำภาคเรียนที่ ${f.term}`,640,e,16),c(t,"ด้าน..................................................",620,e,16),c(t,_,600,e,16),n=560),E(t,60,n,490,o);const Q=(y-u)*o,x=n-Q;D(t,100,n+o,100,x),D(t,170,n+o,170,x),D(t,370,n+o,370,x),D(t,470,n+o,470,x),d(t,"ลำดับ",60,n,40,o,e,14),d(t,"รหัสนักศึกษา",100,n,70,o,e,14),d(t,"ชื่อ - นามสกุล",170,n,200,o,e,14),d(t,"ลายมือชื่อ",370,n,100,o,e,14),d(t,"หมายเหตุ",470,n,80,o,e,14);for(let p=u;p<y;p++)n-=o,E(t,60,n,490,o),d(t,`${p+1}`,60,n,40,o,e,14),d(t,`${r[p].student_id}`,100,n,70,o,e,14),K(t,`${r[p].student_name.split(" ")[0]}`,190,n,o,e,14),K(t,r[p].student_name.split(" ").slice(1).join(" "),290,n,o,e,14);I++}}}const N=await m.save();return new Blob([N],{type:"application/pdf"})}function v({data:l}){const g=async()=>{if(!l||l.length===0){console.error("No data to print");return}const $=await G("/pdf/blank.pdf",l),w=URL.createObjectURL($);window.open(w,"_blank")};return A.jsx(H,{size:"xs",color:"gray",onClick:g,disabled:!l||l.length===0,children:"พิมพ์รายชื่อ"})}export{v as S};
