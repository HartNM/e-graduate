import{t,j as e,A as n,B as p,M as U,D as E,v as W,T as K,E as Q}from"./index-B7_hvkM2.js";import{M as X}from"./ModalInform-NNINQB9X.js";import{u as Y}from"./use-form-DDBi_7fX.js";import{G as C}from"./Group-dxvsYpX2.js";import{B as _}from"./Button-fInQYk36.js";import{S as M}from"./Space-CyCyKMgB.js";/* empty css                    */import"./createReactComponent-DJN_V7q0.js";const g="http://localhost:8080",le=()=>{const[x,S]=t.useState({open:!1,type:"",message:""}),m=(s,a)=>S({open:!0,type:s,message:a}),$=()=>S(s=>({...s,open:!1})),[D,T]=t.useState(!1),h=localStorage.getItem("token"),[k,F]=t.useState([]),[R,u]=t.useState(!1),[i,y]=t.useState(!1),o=Y({initialValues:{user_id:"",name:"",major_id:"",password:"123456"},validate:{user_id:s=>s.trim().length>0?null:"กรุณาเลือกชื่อ",major_id:s=>s.trim().length>0?null:"กรุณาเลือกสาขา"}}),[B,z]=t.useState([]),[O,I]=t.useState([]),[w,j]=t.useState([]),[V,P]=t.useState([]),[v,A]=t.useState(!1);t.useEffect(()=>{(async()=>{try{const a=await fetch(`${g}/api/allAssignMajorOfficer`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`}}),r=await a.json();if(!a.ok)throw new Error(r.message);F(r),P(r),console.log("MajorOfficer :",r);const l=await fetch(`${g}/api/majors`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`}}),c=await l.json();if(!l.ok)throw new Error(c.message);z(c);const b=c.map(f=>({value:f.major_id,label:f.major_name}));I(b),console.log("marjor :",b),console.log("Majors (Raw Data):",c)}catch(a){m("error",a.message),console.error("Error fetch requestExamInfoAll:",a)}T(!1)})()},[D,h]);const q=()=>{o.reset(),j([]),y("add"),u(!0)},G=s=>{o.setValues(s),j([]),y("delete"),u(!0)},L=async()=>{const s={add:`${g}/api/addAssignMajorOfficer`,delete:`${g}/api/deleteAssignMajorOfficer`};console.log(s[i]),console.log(o.values);try{const a=await fetch(s[i],{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(o.values)}),r=await a.json();if(!a.ok)throw new Error(r.message);m("success",r.message),T(!0),u(!1)}catch(a){m("error",a.message),console.error("Error fetch deleteAssignChairpersons:",a)}},H=async s=>{if(o.setFieldValue("major_id",s),o.setFieldValue("user_id",""),o.setFieldValue("name",""),j([]),console.log(o.values),!s)return;const a=B.find(l=>l.major_id===s);if(!a||!a.id_fac){console.error("ไม่พบ id_fac สำหรับสาขานี้:",a),m("error","สาขานี้ไม่มีข้อมูล id_fac");return}const r=a.id_fac;console.log(`Fetching members for id_fac: ${r}`),A(!0);try{const l=await fetch(`https://git.kpru.ac.th/FrontEnd_Admission/admissionnew2022/loadMember/${r}`,{method:"GET",headers:{"Content-Type":"application/json"}}),c=await l.json();if(!l.ok)throw new Error("ดึงข้อมูลบุคลากรไม่สำเร็จ");const f=c.map(d=>({value:d.employee_id,label:`${d.prename_full_tha}${d.first_name_tha} ${d.last_name_tha}`.trim()})).filter(d=>!V.some(N=>N.user_id===d.value));j(f),console.log("Available Members:",f)}catch(l){m("error",l.message)}finally{A(!1)}},J=k.map(s=>{const a=O.find(r=>r.value===s.major_id);return e.jsxs(n.Tr,{children:[e.jsx(n.Td,{children:a?a.label:"-"}),e.jsx(n.Td,{children:s.name}),e.jsx(n.Td,{children:e.jsx(C,{children:e.jsx(_,{color:"red",size:"xs",onClick:()=>G(s),children:"ลบ"})})})]},s.user_id)});return e.jsxs(p,{children:[e.jsx(X,{opened:x.open,onClose:$,message:x.message,type:x.type}),e.jsx(U,{opened:R,onClose:()=>u(!1),title:"กรอกข้อมูลเจ้าหน้าที่ประจำสาขาวิชา",centered:!0,children:e.jsx(p,{children:e.jsxs("form",{onSubmit:o.onSubmit(L),children:[e.jsx(E,{label:"เลือกสาขา",data:O,value:o.values.major_id,onChange:H,error:o.errors.major_id,disabled:i==="delete",placeholder:"เลือกสาขา"}),i==="delete"?e.jsx(W,{label:"ชื่อ",...o.getInputProps("name"),disabled:!0}):e.jsx(E,{label:"ชื่อ",searchable:!0,data:w,placeholder:v?"กำลังโหลด...":"กรุณาเลือกสาขาก่อน",disabled:v||!o.values.major_id,value:o.values.user_id,error:o.errors.user_id,onChange:s=>{o.setFieldValue("user_id",s);const a=w.find(r=>r.value===s);o.setFieldValue("name",a?a.label:"")}}),e.jsx(M,{h:"md"}),e.jsx(_,{color:i==="delete"?"red":"green",type:"submit",fullWidth:!0,children:i==="delete"?"ลบ":"บันทึก"})]})})}),e.jsx(K,{size:"1.5rem",fw:900,mb:"md",children:"กรอกข้อมูลเจ้าหน้าที่ประจำสาขาวิชา"}),e.jsx(M,{h:"xl"}),e.jsxs(C,{justify:"space-between",children:[e.jsx(p,{}),e.jsx(p,{children:e.jsx(_,{variant:"filled",size:"xs",onClick:()=>q(),children:"เพิ่ม"})})]}),e.jsx(M,{h:"xl"}),e.jsx(Q,{type:"scroll",offsetScrollbars:!0,style:{borderRadius:"8px",border:"1px solid #e0e0e0"},children:e.jsxs(n,{horizontalSpacing:"sm",verticalSpacing:"sm",highlightOnHover:!0,children:[e.jsx(n.Thead,{children:e.jsxs(n.Tr,{children:[e.jsx(n.Th,{children:"สาขา"}),e.jsx(n.Th,{children:"อาจารย์"}),e.jsx(n.Th,{children:"การดำเนินการ"})]})}),e.jsx(n.Tbody,{children:J})]})})]})};export{le as default};
