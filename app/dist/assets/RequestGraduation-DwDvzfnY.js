import{t as m,j as e,M as at,v as h,B as R,D as N,A as v,T as it,E as ct}from"./index-B7_hvkM2.js";import{G as u}from"./Grid-C85KIsm1.js";import{S as J}from"./Space-CyCyKMgB.js";import{F as X}from"./Flex-CXnzITNo.js";import{B as T}from"./Button-fInQYk36.js";import{M as lt}from"./ModalApprove-GxzTwETF.js";import{M as dt}from"./ModalPay-B7m0CAUf.js";import{M as ut}from"./ModalInform-NNINQB9X.js";import{P as xt,f as pt,s as ht,a as _t,d as mt,h as yt,e as gt,c as ft}from"./PdfUtils-2D7kTCyc.js";import{j as jt}from"./index-VWaDGczM.js";import{u as bt}from"./use-form-DDBi_7fX.js";import{S as V}from"./Stepper-B-uTcAaD.js";import{P as O}from"./Pill-B7ktLfj6.js";import{G as W}from"./Group-dxvsYpX2.js";import"./get-sorted-breakpoints-BmTdo-hw.js";import"./Checkbox-BOck0Pse.js";import"./Image-QhnbGiva.js";/* empty css                    */import"./createReactComponent-DJN_V7q0.js";import"./dayjs.min-TNDP4t9g.js";const wt=({opened:r,onClose:f,title:l,form:i,handleAdd:k})=>{const[x,S]=m.useState([]),[b,C]=m.useState({contact:{districts:[],subdistricts:[]},work:{districts:[],subdistricts:[]}});m.useEffect(()=>{(async()=>{const _=await(await fetch("https://raw.githubusercontent.com/kongvut/thai-province-data/refs/heads/master/api/latest/province_with_district_and_sub_district.json")).json();S(_.sort((c,y)=>c.name_th.localeCompare(y.name_th,"th")))})()},[]),m.useEffect(()=>{if(!x.length)return;const n=_=>{const c=x.find(p=>p.name_th===i.values[`${_}_province`]),y=c?.districts.find(p=>p.name_th===i.values[`${_}_district`]);C(p=>({...p,[_]:{districts:c?.districts||[],subdistricts:y?.sub_districts||[]}}))};n("contact"),n("work")},[x,r]);const s=(n,_,c)=>{if(console.log(n,_,c),_==="province"){const y=x.find(p=>String(p.id)===c);i.setValues({[`${n}_province`]:y?.name_th||"",[`${n}_district`]:"",[`${n}_subdistrict`]:"",[`${n}_zipcode`]:""}),C(p=>({...p,[n]:{districts:y?.districts||[],subdistricts:[]}}))}else if(_==="district"){const y=b[n].districts.find(p=>String(p.id)===c);i.setValues({[`${n}_district`]:y?.name_th||"",[`${n}_subdistrict`]:"",[`${n}_zipcode`]:""}),C(p=>({...p,[n]:{...p[n],subdistricts:y?.sub_districts||[]}}))}else if(_==="subdistrict"){const y=b[n].subdistricts.find(p=>String(p.id)===c);i.setValues({[`${n}_subdistrict`]:y?.name_th||"",[`${n}_zipcode`]:y?.zip_code??""})}},o=(n,_="")=>e.jsxs(e.Fragment,{children:[e.jsx(u.Col,{span:{base:12,md:4},children:e.jsx(N,{label:`${_}จังหวัด`,placeholder:"เลือกจังหวัด",data:x.map(c=>({value:String(c.id),label:c.name_th})),value:x.find(c=>c.name_th===i.values[`${n}_province`])?.id?.toString()||"",onChange:c=>s(n,"province",c)})}),e.jsx(u.Col,{span:{base:12,md:4},children:e.jsx(N,{label:`${_}อำเภอ`,placeholder:"เลือกอำเภอ",data:b[n].districts.map(c=>({value:String(c.id),label:c.name_th})),value:b[n].districts.find(c=>c.name_th===i.values[`${n}_district`])?.id?.toString()||"",onChange:c=>s(n,"district",c),disabled:!b[n].districts.length})}),e.jsx(u.Col,{span:{base:12,md:4},children:e.jsx(N,{label:`${_}ตำบล`,placeholder:"เลือกตำบล",data:b[n].subdistricts.map(c=>({value:String(c.id),label:c.name_th})),value:b[n].subdistricts.find(c=>c.name_th===i.values[`${n}_subdistrict`])?.id?.toString()||"",onChange:c=>s(n,"subdistrict",c),disabled:!b[n].subdistricts.length})}),e.jsx(u.Col,{span:{base:12,md:4},children:e.jsx(h,{label:`${_}รหัสไปรษณีย์`,readOnly:!0,...i.getInputProps(`${n}_zipcode`)})})]});return e.jsx(at,{opened:r,onClose:f,title:l,centered:!0,size:"800",children:e.jsxs("form",{onSubmit:i.onSubmit(k),children:[e.jsxs(u,{type:"container",breakpoints:{md:"660px"},children:[e.jsxs(u.Col,{span:{base:12,md:6},children:[e.jsx(h,{label:"ชื่อ-นามสกุล",disabled:!0,...i.getInputProps("student_name")}),e.jsx(h,{label:"รหัสประจำตัว",disabled:!0,...i.getInputProps("student_id")}),e.jsx(h,{label:"ระดับการศึกษา",disabled:!0,...i.getInputProps("education_level")}),e.jsx(h,{label:"หลักสูตร",disabled:!0,...i.getInputProps("program")}),e.jsx(h,{label:"สาขาวิชา",disabled:!0,...i.getInputProps("major_name")}),e.jsx(h,{label:"คณะ",disabled:!0,...i.getInputProps("faculty_name")}),e.jsx(R,{mt:"md",mb:"sm",fw:500,children:"วุฒิเดิมในระดับปริญญาตรี"}),e.jsxs(u,{breakpoints:{md:"660px"},children:[e.jsx(u.Col,{span:{base:12,md:6},children:e.jsx(h,{label:"สาขา",...i.getInputProps("bachelor_major")})}),e.jsx(u.Col,{span:{base:12,md:6},children:e.jsx(h,{label:"มหาวิทยาลัย",...i.getInputProps("bachelor_university")})})]}),i.values.education_level==="ปริญญาเอก"&&e.jsxs(R,{mt:"md",mb:"sm",fw:500,children:["วุฒิเดิมในระดับปริญญาโท",e.jsxs(u,{breakpoints:{md:"660px"},children:[e.jsx(u.Col,{span:{base:12,md:6},children:e.jsx(h,{label:"สาขา",...i.getInputProps("master_major")})}),e.jsx(u.Col,{span:{base:12,md:6},children:e.jsx(h,{label:"มหาวิทยาลัย",...i.getInputProps("master_university")})})]})]})]}),e.jsxs(u.Col,{span:{base:12,md:6},children:[e.jsx(R,{mt:"md",mb:"sm",fw:500,children:"ที่อยู่สามารถติดต่อได้"}),e.jsxs(u,{breakpoints:{md:"660px"},children:[e.jsx(u.Col,{span:{base:12,md:4},children:e.jsx(h,{label:"บ้านเลขที่",...i.getInputProps("contact_house_no")})}),e.jsx(u.Col,{span:{base:12,md:4},children:e.jsx(h,{label:"หมู่ที่",...i.getInputProps("contact_moo")})}),e.jsx(u.Col,{span:{base:12,md:4},children:e.jsx(h,{label:"ถนน",...i.getInputProps("contact_road")})}),o("contact"),e.jsx(u.Col,{span:{base:12,md:4},children:e.jsx(h,{label:"โทรศัพท์",...i.getInputProps("contact_phone"),onInput:n=>n.target.value=n.target.value.replace(/[^0-9]/g,"")})})]}),e.jsx(R,{mt:"md",mb:"sm",fw:500,children:"สถานที่ทำงานปัจจุบัน"}),e.jsxs(u,{breakpoints:{md:"660px"},children:[e.jsx(u.Col,{span:{base:12,md:6},children:e.jsx(h,{label:"สถานที่ทำงาน",...i.getInputProps("work_name")})}),e.jsx(u.Col,{span:{base:12,md:3},children:e.jsx(h,{label:"หมู่ที่",...i.getInputProps("work_moo")})}),e.jsx(u.Col,{span:{base:12,md:3},children:e.jsx(h,{label:"ถนน",...i.getInputProps("work_road")})}),o("work"),e.jsx(u.Col,{span:{base:12,md:4},children:e.jsx(h,{label:"โทรศัพท์",...i.getInputProps("work_phone"),onInput:n=>n.target.value=n.target.value.replace(/[^0-9]/g,"")})}),e.jsx(u.Col,{span:{base:12,md:12},children:e.jsx(h,{label:"สังกัดหน่วยงาน",...i.getInputProps("work_department")})})]})]})]}),e.jsx(J,{h:"lg"}),e.jsx(X,{justify:"flex-end",children:e.jsx(T,{type:"submit",color:"green",children:"บันทึก"})})]})})};async function H(r){const f=await xt.create();f.registerFontkit(pt);const l=f.addPage([595,842]);await ht(f);const i=await fetch("/fonts/THSarabunNew Bold.ttf").then(g=>g.arrayBuffer()),k=await f.embedFont(i),x=await fetch("/image/krut-3-cm.png").then(g=>g.arrayBuffer()),S=await f.embedPng(x),b=S.scale(.085);function C(g){if(!g)return["","",""];const[z,G,F]=g.split("/"),L=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"][parseInt(G,10)-1]||"";return[z,L,F]}let s=760,o=20;const[n,_,c]=_t(r?.request_date),[y,p,E]=C(r?.BDATE);l.drawImage(S,{x:60,y:s,width:b.width,height:b.height}),mt(l,"บันทึกข้อความ",s+20,k,20);const $=[{text:"ส่วนราชการ",x:60,y:s-=o,font:k},{text:"มหาวิทยาลัยราชภัฏกำแพงเพชร",x:120,y:s},{text:"ที่………………………………………………………………                                       วันที่………………เดือน……………………………พ.ศ………………",x:60,y:s-=o},{text:n,x:370,y:s+2},{text:_,x:440,y:s+2},{text:c,x:520,y:s+2},{text:"เรื่อง    ขอสำเร็จการศึกษาระดับบัณฑิตศึกษา",x:60,y:s-=o},{text:"เรียน    อธิการบดีมหาวิทยาลัยราชภัฏกำแพงเพชร",x:60,y:s-=o},{text:"ข้าพเจ้า………………………………………………………………………………………………………………………………………………………",x:100,y:s-=o},{text:r?.student_name,x:170,y:s+2},{text:"ระดับปริญญาโท  สาขา………………………………………………………………รหัสประจำตัว………………………………………………….",x:80,y:s-=o,show:r?.education_level==="ปริญญาโท"},{text:"ระดับปริญญาเอก  สาขา………………………………………………………………รหัสประจำตัว………………………………………………….",x:80,y:s,show:r?.education_level==="ปริญญาเอก"},{text:r?.major_name,x:180,y:s+2},{text:r?.student_id,x:390,y:s+2},{text:"วุฒิเดิมในระดับปริญญาตรี  สาขา………………………………………….มหาวิทยาลัย…………………………………………………..",x:100,y:s-=o},{text:r?.bachelor_major,x:230,y:s+2},{text:r?.bachelor_university,x:390,y:s+2},{text:"วุฒิเดิมในระดับปริญญาโท  สาขา………………………………………….มหาวิทยาลัย……………………………………………………",x:100,y:s-=o,show:r?.education_level==="ปริญญาเอก"},{text:r?.master_major,x:230,y:s+2},{text:r?.master_university,x:390,y:s+2},{text:"เกิดวันที่………………เดือน………………………………พ.ศ………………",x:100,y:r?.education_level==="ปริญญาโท"?s-=o*1:s-=o},{text:y,x:140,y:s+2},{text:p,x:210,y:s+2},{text:E,x:290,y:s+2},{text:"ที่อยู่สามารถติดต่อได้  บ้านเลขที่…………………..หมู่ที่……..…………ถนน………………….ตำบล……………..…….………..",x:60,y:s-=o},{text:r?.contact_house_no,x:190,y:s+2},{text:r?.contact_moo,x:260,y:s+2},{text:r?.contact_road,x:320,y:s+2},{text:r?.contact_subdistrict,x:390,y:s+2},{text:"อำเภอ……………………………..จังหวัด……………………รหัสไปรษณีย์………………….โทรศัพท์………………….……………..",x:60,y:s-=o},{text:r?.contact_district,x:90,y:s+2},{text:r?.contact_province,x:190,y:s+2},{text:r?.contact_zipcode,x:300,y:s+2},{text:r?.contact_phone,x:380,y:s+2},{text:"สถานที่ทำงานปัจจุบัน…………………..…………หมู่ที่………………..ถนน…………………..ตำบล…………………………………",x:60,y:s-=o},{text:r?.work_name,x:150,y:s+2},{text:r?.work_moo,x:240,y:s+2},{text:r?.work_road,x:305,y:s+2},{text:r?.work_subdistrict,x:380,y:s+2},{text:"อำเภอ……………………………..จังหวัด……………………รหัสไปรษณีย์………………….โทรศัพท์………………….……………..",x:60,y:s-=o},{text:r?.work_district,x:90,y:s+2},{text:r?.work_province,x:190,y:s+2},{text:r?.work_zipcode,x:300,y:s+2},{text:r?.work_phone,x:380,y:s+2},{text:"สังกัดหน่วยงาน………………………………..……........................... ได้ศึกษาจนครบหลักสูตรจึงขอสำเร็จการศึกษาในภาคเรียนนี้",x:60,y:s-=o},{text:r?.work_department,x:130,y:s+2},{text:"จึงเรียนมาเพื่อโปรดพิจารณา",x:100,y:s-=o},{text:"ลงชื่อ.........................................................( นักศึกษา )",x:240,y:s-=o},{text:r?.student_name,x:280,y:s+2},{text:"(.........................................................)",x:260,y:s-=o},{text:r?.student_name,x:280,y:s+2},{text:"ความเห็นของอาจารย์ที่ปรึกษา",x:60,y:s-=o},{text:"ศึกษารายวิชาและจำนวนหน่วยกิตครบตามหลักสูตรเรียบร้อยแล้ว ",x:100,y:s-=o},{text:`${r?.education_level==="ปริญญาโท"?"สอบประมวลความรู้":"สอบวัดคุณสมบัติ"} ผ่านเรียบร้อย`,x:100,y:s-=o},{text:"กำลังดำเนินการทำวิทยานิพนธ์  ในขั้น…………………………………….",x:100,y:s-=o},{text:"100%",x:250,y:s+2,show:r.advisor_approvals_id!=null},{text:"ลงชื่อ.........................................................อาจารย์ที่ปรึกษา         ลงชื่อ.........................................................ประธานคณะกรรมการ ",x:60,y:s-=o*2},{text:r?.advisor_approvals_id,x:100,y:s+2},{text:r?.chairpersons_approvals_id,x:340,y:s+2},{text:"(........................................................)                                   (........................................................) บัณฑิตศึกษาประจำสาขาวิชา",x:80,y:s-=o},{text:r?.advisor_approvals_id,x:100,y:s+2},{text:r?.chairpersons_approvals_id,x:340,y:s+2},{text:"ชำระเงิน",x:60,y:s-=o},{text:"ทางฝ่ายการเงินได้รับเงินค่าลงทะเบียนบัณฑิต  จำนวน  1,000  บาท  ในใบเสร็จรับเงิน……………./…………....",x:100,y:s-=o},{text:"ลงชื่อ........................................................ผู้รับเงิน",x:240,y:s-=o},{text:"นายณัฐวุฒิ มาตกาง",x:280,y:s+2,show:r?.receipt_vol!=null},{text:"(........................................................)",x:260,y:s-=o},{text:"นายณัฐวุฒิ มาตกาง",x:280,y:s+2,show:r?.receipt_vol!=null},{text:"------------------------------------------------------------------------------------------------------------------------------------------------------------------ ",x:60,y:s-=o},{text:"กรุณานำส่ง",x:240,y:s-=o*2,font:k},{text:"สถานที่ติดต่อเพื่อแจ้งรายละเอียด",x:60,y:s-=o},{text:"คุณ………………………………………………………………………….",x:270,y:s},{text:r?.student_name,x:300,y:s+2},{text:"เกี่ยวกับพิธีพระราชทานปริญญาบัตร",x:60,y:s-=o},{text:"เลขที่………………………ถนน………………………………………..",x:270,y:s},{text:r?.contact_house_no,x:300,y:s+2},{text:r?.contact_moo,x:390,y:s+2},{text:"ตำบล……………………………อำเภอ……………………………….",x:270,y:s-=o},{text:r?.contact_subdistrict,x:310,y:s+2},{text:r?.contact_district,x:410,y:s+2},{text:"จังหวัด……………………………รหัสไปรษณีย์……………………",x:270,y:s-=o},{text:r?.work_province,x:310,y:s+2},{text:r?.work_zipcode,x:430,y:s+2}];yt(l,60,s+o*31.75,550,s+o*31.75),gt(l,230,s-=o,300,o*6),$.filter(g=>g.show!==!1).forEach(g=>ft(l,g.text,g.x,g.y,g.font,g.size));const I=await f.save();return new Blob([I],{type:"application/pdf"})}function vt({data:r,showType:f}){const l=async()=>{const k=await H(r),x=URL.createObjectURL(k);window.open(x,"_blank")},i=async()=>{const k=await H(r),x=URL.createObjectURL(k),S=document.createElement("iframe");S.style.display="none",S.src=x,document.body.appendChild(S),S.onload=()=>{S.contentWindow.print()}};return e.jsx(e.Fragment,{children:f==="view"?e.jsx(T,{size:"xs",color:"gray",onClick:l,children:"ข้อมูล"}):e.jsx(T,{size:"xs",color:"blue",onClick:i,children:"พิมพ์"})})}const P="http://localhost:8080",Wt=()=>{const r=localStorage.getItem("token"),f=jt(r),l=f.role;f.user_id,console.log("token :",f);const[i,k]=m.useState({open:!1,type:"",message:""}),x=(t,a)=>k({open:!0,type:t,message:a}),S=()=>k(t=>({...t,open:!1})),[b,C]=m.useState(!1),[s,o]=m.useState(!1),[n,_]=m.useState(!1),[c,y]=m.useState(!1),[p,E]=m.useState(null),[$,I]=m.useState("approve"),[g,z]=m.useState(""),[G,F]=m.useState(""),[M,L]=m.useState(""),[K,D]=m.useState([]),[U,Q]=m.useState(""),q=bt({initialValues:{student_name:"",study_group_id:"",student_id:"",education_level:"",program:"",major_name:"",faculty_name:"",bachelor_major:"",bachelor_university:"",master_major:"",master_university:"",contact_house_no:"",contact_moo:"",contact_road:"",contact_subdistrict:"",contact_district:"",contact_province:"",contact_zipcode:"",contact_phone:"",work_name:"",work_moo:"",work_road:"",work_subdistrict:"",work_district:"",work_province:"",work_zipcode:"",work_phone:"",work_department:""},validate:{bachelor_major:t=>t.trim()===""?"กรุณากรอกสาขาป.ตรี":null,bachelor_university:t=>t.trim()===""?"กรุณากรอกมหาวิทยาลัยป.ตรี":null,master_major:(t,a)=>a.education_level==="ปริญญาเอก"&&t.trim()===""?"กรุณากรอกสาขาป.โท":null,master_university:(t,a)=>a.education_level==="ปริญญาเอก"&&t.trim()===""?"กรุณากรอกมหาวิทยาลัยป.โท":null,contact_house_no:t=>t.trim()===""?"กรุณากรอกบ้านเลขที่":null,contact_moo:t=>t.trim()===""?"กรุณากรอกหมู่ที่":null,contact_road:t=>t.trim()===""?"กรุณากรอกถนน":null,contact_subdistrict:t=>t.trim()===""?"กรุณากรอกตำบล":null,contact_district:t=>t.trim()===""?"กรุณากรอกอำเภอ":null,contact_province:t=>t.trim()===""?"กรุณากรอกจังหวัด":null,contact_zipcode:t=>t===""?"กรุณากรอกรหัสไปรษณีย์":null,contact_phone:t=>t.trim()===""?"กรุณากรอกเบอร์โทร":null,work_name:t=>t.trim()===""?"กรุณากรอกสถานที่ทำงาน":null,work_moo:t=>t.trim()===""?"กรุณากรอกหมู่ที่":null,work_road:t=>t.trim()===""?"กรุณากรอกถนน":null,work_subdistrict:t=>t.trim()===""?"กรุณากรอกตำบล":null,work_district:t=>t.trim()===""?"กรุณากรอกอำเภอ":null,work_province:t=>t.trim()===""?"กรุณากรอกจังหวัด":null,work_zipcode:t=>t===""?"กรุณากรอกรหัสไปรษณีย์":null,work_phone:t=>t.trim()===""?"กรุณากรอกเบอร์โทร":null,work_department:t=>t.trim()===""?"กรุณากรอกหน่วยงาน":null}});m.useEffect(()=>{(async()=>{try{const a=await fetch(`${P}/api/profile`,{method:"GET",headers:{Authorization:`Bearer ${r}`}}),d=await a.json();if(!a.ok)throw new Error(d.message);L(d),console.log(d)}catch(a){x("error",a.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),console.error("Error fetching profile:",a)}})()},[r]);const[A,B]=m.useState(null);m.useEffect(()=>{(async()=>{try{const a=await fetch(`${P}/api/allRequestGraduation`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}}),d=await a.json();if(!a.ok)throw new Error(d.message);D(d),console.log(d);const w=await fetch(`${P}/api/allRequestThesisDefense`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}}),j=await w.json();if(!w.ok)throw new Error(j.message);console.log(j),j[0]?.status==="5"&&j[0]?.exam_results==="ผ่าน"&&(d[0]?.status==="6"||d[0]?.status===void 0)?B(!1):B(!0)}catch(a){x("error",a.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),console.error("Error fetching allRequestGraduation:",a)}})()},[]);const Y=async()=>{try{const t=await fetch(`${P}/api/studentInfo`,{method:"GET",headers:{Authorization:`Bearer ${r}`}}),a=await t.json();if(!t.ok)throw new Error(a.message);q.reset(),q.setValues(a),C(!0)}catch(t){x("error",t.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),console.error("Error fetching studentInfo:",t)}},Z=async()=>{try{const t=await fetch(`${P}/api/addRequestGraduation`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(q.values)}),a=await t.json();if(!t.ok)throw new Error(a.message);x("success",a.message||"สำเร็จ"),C(!1),D(d=>q.values.request_graduation_id?d.map(w=>w.request_graduation_id===q.values.request_graduation_id?{...w,...a.data,...q.values}:w):[...d,{...a.data,...q.values}]),B({...a.data,...q.values})}catch(t){x("error",t.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),console.error("Error fetching addRequestGraduation:",t)}},tt=async t=>{q.setValues(t),C(!0)},et=async t=>{if($==="noapprove"&&g.trim()===""){F("กรุณาระบุเหตุผล");return}console.log(t);try{const a=await fetch(`${P}/api/approveRequestGraduation`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({request_graduation_id:t.request_graduation_id,name:M.name,role:l,selected:$,comment:g})}),d=await a.json();if(!a.ok)throw new Error(d.message);x("success",d.message||"สำเร็จ"),I("approve"),z(""),o(!1),D(w=>w.map(j=>j.request_graduation_id===t.request_graduation_id?{...j,...d.data}:j))}catch(a){x("error",a.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),console.error("Error fetching approveRequestGraduation:",a)}},st=async t=>{try{const a=await fetch(`${P}/api/payRequestGraduation`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({request_graduation_id:t.request_graduation_id,receipt_vol:"154",receipt_No:"4",receipt_pay:"1000"})}),d=await a.json();if(!a.ok)throw new Error(d.message);x("success",d.message||"สำเร็จ"),y(!1),D(w=>w.map(j=>j.request_graduation_id===t.request_graduation_id?{...j,...d.data}:j))}catch(a){x("error",a.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),console.error("Error fetching payRequestGraduation:",a)}};function rt(t,a){return a==="student"?t:t.sort((d,w)=>{const j=Number(d.status)===0?1:0,nt=Number(w.status)===0?1:0;return j-nt||Number(d.status)-Number(w.status)})}const ot=rt(K,l).filter(t=>[t.student_name,t.student_id].join(" ").toLowerCase().includes(U.toLowerCase())).map(t=>e.jsxs(v.Tr,{children:[e.jsx(v.Td,{children:t.student_name}),["advisor","officer_registrar","chairpersons"].includes(l)&&e.jsx(v.Td,{children:t.request_type}),e.jsxs(v.Td,{style:{textAlign:"center"},children:[t.status<=4&&t.status>0&&e.jsx(V,{active:t.status==="4"?t.status-2:t.status-1,iconSize:20,styles:{separator:{marginLeft:-4,marginRight:-4},stepIcon:{fontSize:10}},children:[...Array(3)].map((a,d)=>e.jsx(V.Step,{children:e.jsx(O,{children:t.status_text})},d))}),(t.status==0||t.status>6)&&e.jsx(O,{variant:"filled",style:{backgroundColor:"#ffcccc",color:"#b30000"},children:t.status_text}),t.status==5&&e.jsx(O,{variant:"filled",style:{backgroundColor:"#ccffcc",color:"#006600"},children:t.status_text}),t.status==6&&e.jsxs(e.Fragment,{children:[e.jsx(O,{variant:"filled",style:{backgroundColor:"#ffcccc",color:"#b30000"},children:t.status_text}),e.jsx("br",{}),!t.advisor_approvals&&"อาจารย์ที่ปรึกษา",t.advisor_approvals&&!t.chairpersons_approvals&&"ประธานหลักสูตร"]})]}),e.jsx(v.Td,{style:{maxWidth:"150px"},children:e.jsxs(W,{children:[l==="student"&&e.jsxs(e.Fragment,{children:[t.status!=5&&e.jsx(T,{size:"xs",color:"yellow",onClick:()=>tt(t),children:"แก้ไข"}),t.status==="4"&&e.jsx(T,{size:"xs",color:"green",onClick:()=>{E(t),y(!0)},children:"ชำระค่าธรรมเนียม"}),(t.status==5||t.status==0||t.status>6)&&e.jsx(T,{size:"xs",color:"green",children:"พิมพ์ใบเสร็จ"})]}),e.jsx(vt,{data:t,showType:t.status==0?void 0:l==="advisor"&&t.status<=1||l==="chairpersons"&&t.status<=2||l==="officer_registrar"&&t.status<=3?"view":void 0}),(l==="advisor"&&t.status==1||l==="chairpersons"&&t.status==2||l==="officer_registrar"&&t.status==3)&&e.jsx(T,{size:"xs",color:"green",onClick:()=>{E(t),_("add"),o(!0)},children:l==="officer_registrar"?"ตรวจสอบ":"ลงความเห็น"})]})})]},t.request_graduation_id));return e.jsxs(R,{children:[e.jsx(ut,{opened:i.open,onClose:S,message:i.message,type:i.type}),e.jsx(lt,{opened:s,onClose:()=>o(!1),selectedRow:p,selected:$,setSelected:I,comment:g,setComment:z,error:G,openApproveState:n,handleApprove:et,role:l,title:"คำร้องขอสำเร็จการศึกษาระดับบัณฑิตศึกษา"}),e.jsx(wt,{opened:b,onClose:()=>C(!1),form:q,handleAdd:Z,title:"เพิ่มคำร้องขอสำเร็จการศึกษาระดับบัณฑิตศึกษา"}),e.jsx(dt,{opened:c,onClose:()=>y(!1),selectedRow:p,handlePay:st}),e.jsx(it,{size:"1.5rem",fw:900,mb:"md",children:"คำร้องขอสำเร็จการศึกษาระดับบัณฑิตศึกษา"}),e.jsxs(W,{justify:"space-between",children:[e.jsx(R,{children:e.jsxs(X,{align:"flex-end",gap:"sm",children:[l!=="student"&&e.jsx(h,{placeholder:"ค้นหาชื่่อ รหัส",value:U,onChange:t=>Q(t.target.value)})," "]})}),e.jsx(R,{children:l==="student"&&e.jsx(T,{onClick:()=>Y(),disabled:A?A.status!=="0"&&A.status!=="6"&&A.exam_results!==!1:!1,children:"เพิ่มคำร้อง"})})]}),e.jsx(J,{h:"md"}),e.jsx(ct,{type:"scroll",offsetScrollbars:!0,style:{borderRadius:"8px",border:"1px solid #e0e0e0"},children:e.jsxs(v,{horizontalSpacing:"sm",verticalSpacing:"sm",highlightOnHover:!0,children:[e.jsx(v.Thead,{children:e.jsxs(v.Tr,{children:[e.jsx(v.Th,{style:{minWidth:100},children:"ชื่อ"}),["advisor","officer_registrar","chairpersons"].includes(l)&&e.jsx(v.Th,{style:{minWidth:100},children:"เรื่อง"}),e.jsx(v.Th,{style:{minWidth:110},children:"สถานะ"}),e.jsx(v.Th,{children:"การดำเนินการ"})]})}),e.jsx(v.Tbody,{children:ot})]})})]})};export{Wt as default};
