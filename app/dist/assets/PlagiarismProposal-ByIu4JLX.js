import{t as n,z as Q,j as s,A as i,B as y,T as X,v as Y,E as Z}from"./index-B7_hvkM2.js";import{M as ee}from"./ModalAddPlagiarismReport-D0HZqbGm.js";import{M as se}from"./ModalApprove-GxzTwETF.js";import{M as te}from"./ModalInform-NNINQB9X.js";import{P as re}from"./Pdfg06-CN5UwjHB.js";import{u as ae}from"./use-form-DDBi_7fX.js";import{S as E}from"./Stepper-B-uTcAaD.js";import{P as S}from"./Pill-B7ktLfj6.js";import{G as R}from"./Group-dxvsYpX2.js";import{B as v}from"./Button-fInQYk36.js";import{F as oe}from"./Flex-CXnzITNo.js";import{S as ne}from"./Space-CyCyKMgB.js";import"./Grid-C85KIsm1.js";import"./get-sorted-breakpoints-BmTdo-hw.js";import"./DatePickerInput-DIAi7llo.js";import"./dayjs.min-TNDP4t9g.js";import"./use-disclosure-f2FIm-Gp.js";import"./Checkbox-BOck0Pse.js";/* empty css                    */import"./createReactComponent-DJN_V7q0.js";import"./PdfUtils-2D7kTCyc.js";const d="http://localhost:8080",$e=()=>{const c=localStorage.getItem("token"),b=c.split(".")[1],l=JSON.parse(atob(b)).role,[f,w]=n.useState({open:!1,type:"",message:""}),p=(e,t)=>w({open:!0,type:e,message:t}),q=()=>w(e=>({...e,open:!1})),[C,m]=n.useState(!1),[O,g]=n.useState(!1),[B,D]=n.useState(!1),[le,ce]=n.useState(!1),[$,k]=n.useState(null),[x,T]=n.useState("approve"),[_,P]=n.useState(""),[z,I]=n.useState(""),[pe,F]=n.useState(""),[N,j]=n.useState([]),[A,M]=n.useState(""),{type:de}=Q(),L=e=>e===null||e===""?"ห้ามเว้นว่าง":e<0||e>100?"กรอก 0-100 เท่านั้น":null,h=ae({initialValues:{student_name:"",study_group_id:"",student_id:"",education_level:"",program:"",major_name:"",faculty_name:"",research_name:"",chapter_1:0,chapter_2:0,chapter_3:0,inspection_date:null,plagiarism_file:null,full_report_file:null},validate:e=>{const t={};return(e.research_name||"").trim()||(t.research_name="กรุณากรอกชื่อวิจัย"),e.inspection_date||(t.inspection_date="กรุณาระบุวันที่ปิด"),["chapter_1","chapter_2","chapter_3"].forEach(a=>{const o=L(e[a]);o&&(t[a]=o)}),e.plagiarism_file instanceof File||(t.plagiarism_file="กรุณาอัปโหลดไฟล์ตรวจสอบ"),e.full_report_file instanceof File||(t.full_report_file="กรุณาอัปโหลดไฟล์รายงานฉบับเต็ม"),t}});n.useEffect(()=>{(async()=>{try{const t=await fetch(`${d}/api/profile`,{method:"GET",headers:{Authorization:`Bearer ${c}`}}),r=await t.json();if(!t.ok)throw new Error(r.message);F(r),console.log(r)}catch(t){p("error",t.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),console.error("Error fetching profile:",t)}})()},[c]);const[G,u]=n.useState(!0);n.useEffect(()=>{(async()=>{try{const t=await fetch(`${d}/api/AllPlagiarismProposal`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`}}),r=await t.json();if(!t.ok)throw new Error(r.message);if(j(r),l=="student"){const a=await fetch(`${d}/api/allRequestThesisProposal`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({lastRequest:!0})}),o=await a.json();if(!a.ok)throw new Error(o.message);o.length==1?r[0]?.status<6?u(!0):u(!1):u(!0)}}catch(t){p("error",t.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),console.error("Error fetching AllPlagiarismProposal:",t)}})()},[]);const J=async()=>{try{const e=await fetch(`${d}/api/studentInfo`,{method:"GET",headers:{Authorization:`Bearer ${c}`}}),t=await e.json();if(!e.ok)throw new Error(t.message);const r=await fetch(`${d}/api/allRequestThesisProposal`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({lastRequest:!0})}),a=await r.json();if(!r.ok)throw new Error(a.message);h.reset(),h.setValues({...t,...a[0]}),m(!0)}catch(e){p("error",e.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),console.error("Error fetching studentInfo:",e)}},W=async()=>{try{const e=new FormData;Object.entries(h.values).forEach(([a,o])=>{o instanceof Date?e.append(a,o.toISOString()):o instanceof File?e.append(a,o,o.name):e.append(a,o??"")});const t=await fetch(`${d}/api/addPlagiarismProposal`,{method:"POST",headers:{Authorization:`Bearer ${c}`},body:e});if(!t.ok)throw new Error(r.message);const r=await t.json();p("success",r.message),u(!0),m(!1),j(a=>[...a,{...h.values,...r.data}])}catch(e){p("error",e.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),console.error("Error fetching addPlagiarismProposal:",e)}},U=async e=>{if(x==="noapprove"&&_.trim()===""){I("กรุณาระบุเหตุผล");return}try{const t=await fetch(`${d}/api/approvePlagiarismProposal`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({plagiarism_report_id:e.plagiarism_report_id,selected:x,comment:_})}),r=await t.json();if(!t.ok)throw new Error(r.message);p("success",r.message),T("approve"),P(""),g(!1),j(a=>a.map(o=>o.plagiarism_report_id===e.plagiarism_report_id?{...o,...r.data}:o))}catch(t){p("error",t.message||"เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),console.error("Error fetching approvePlagiarismProposal:",t)}};function V(e,t){return t==="student"?e:e.sort((r,a)=>{const o=Number(r.status)===0?1:0,K=Number(a.status)===0?1:0;return o-K||Number(r.status)-Number(a.status)})}const H=V(N,l).filter(e=>[e.student_name,e.student_id].join(" ").toLowerCase().includes(A.toLowerCase())).map(e=>s.jsxs(i.Tr,{children:[s.jsx(i.Td,{children:e.student_name}),s.jsx(i.Td,{children:e.request_thesis_type.replace("ขอสอบ","")}),s.jsxs(i.Td,{style:{textAlign:"center"},children:[e.status<=4&&e.status>0&&s.jsx(E,{active:e.status-1,iconSize:20,styles:{separator:{marginLeft:-4,marginRight:-4},stepIcon:{fontSize:10}},children:[...Array(2)].map((t,r)=>s.jsx(E.Step,{children:s.jsx(S,{children:e.status_text})},r))}),e.status==5&&s.jsx(S,{variant:"filled",style:{backgroundColor:"#ccffcc",color:"#006600"},children:e.status_text}),e.status==6&&s.jsxs(s.Fragment,{children:[s.jsx(S,{variant:"filled",style:{backgroundColor:"#ffcccc",color:"#b30000"},children:e.status_text}),s.jsx("br",{}),!e.advisor_approvals&&"อาจารย์ที่ปรึกษา",e.advisor_approvals&&!e.chairpersons_approvals&&"ประธานหลักสูตร"]})]}),s.jsx(i.Td,{style:{maxWidth:"150px"},children:s.jsxs(R,{children:[s.jsx(re,{data:e,showType:e.status==0?void 0:l==="advisor"&&e.status<=1||l==="chairpersons"&&e.status<=2||l==="officer_registrar"&&e.status<=3?"view":void 0}),(l==="research_advisor"&&e.status==1||l==="chairpersons"&&e.status==2||l==="officer_registrar"&&e.status==3)&&s.jsx(v,{size:"xs",color:"green",onClick:()=>{k(e),D("add"),g(!0)},children:"ลงความเห็น"})]})})]},e.plagiarism_report_id));return s.jsxs(y,{children:[s.jsx(te,{opened:f.open,onClose:q,message:f.message,type:f.type}),s.jsx(se,{opened:O,onClose:()=>g(!1),selectedRow:$,selected:x,setSelected:T,comment:_,setComment:P,error:z,openApproveState:B,handleApprove:U,role:l,title:"ลงความเห็นรายงานผลการตรวจสอบการคัดลอกผลงานทางวิชาการ"}),s.jsx(ee,{opened:C,onClose:()=>m(!1),form:h,handleAdd:W,title:"เพิ่มรายงานผลการตรวจสอบการคัดลอกผลงานทางวิชาการ"}),s.jsx(X,{size:"1.5rem",fw:900,mb:"md",children:"รายงานผลตรวจสอบการคัดลอก โครงร่างวิทยานิพนธ์/การค้นคว้าอิสระ"}),s.jsxs(R,{justify:"space-between",children:[s.jsx(y,{children:s.jsx(oe,{align:"flex-end",gap:"sm",children:l!=="student"&&s.jsx(Y,{placeholder:"ค้นหาชื่่อ รหัส",value:A,onChange:e=>M(e.target.value)})})}),s.jsx(y,{children:l==="student"&&s.jsx(v,{onClick:()=>J(),disabled:G,children:"เพิ่มคำร้อง"})})]}),s.jsx(ne,{h:"md"}),s.jsx(Z,{type:"scroll",offsetScrollbars:!0,style:{borderRadius:"8px",border:"1px solid #e0e0e0"},children:s.jsxs(i,{horizontalSpacing:"sm",verticalSpacing:"sm",highlightOnHover:!0,children:[s.jsx(i.Thead,{children:s.jsxs(i.Tr,{children:[s.jsx(i.Th,{style:{minWidth:100},children:"ชื่อ"}),s.jsx(i.Th,{style:{minWidth:100},children:"ชนิด"}),s.jsx(i.Th,{style:{minWidth:110},children:"สถานะ"}),s.jsx(i.Th,{children:"การดำเนินการ"})]})}),s.jsx(i.Tbody,{children:H})]})})]})};export{$e as default};
