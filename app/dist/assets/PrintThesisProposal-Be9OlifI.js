import{t as n,j as e,B as C,T as I,v as k,D as v,E as B,A as r}from"./index-B7_hvkM2.js";import{u as p,w as A}from"./xlsx-mxuUxWRI.js";import{S as z}from"./PdfPrintExam-BD-EPQ_H.js";import{M as $}from"./ModalInform-NNINQB9X.js";import{G as u}from"./Group-dxvsYpX2.js";import{B as O}from"./Button-fInQYk36.js";import{S as P}from"./Space-CyCyKMgB.js";import"./PdfUtils-2D7kTCyc.js";import"./dayjs.min-TNDP4t9g.js";/* empty css                    */import"./createReactComponent-DJN_V7q0.js";const S="http://localhost:8080",W=()=>{const[m,x]=n.useState({open:!1,type:"",message:""}),f=(t,s)=>x({open:!0,type:t,message:s}),T=()=>x(t=>({...t,open:!1})),j=localStorage.getItem("token"),[w,y]=n.useState([]),[l,g]=n.useState("");n.useEffect(()=>{(async()=>{try{const s=await fetch(`${S}/api/allRequestExamInfo`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`}}),o=await s.json();if(!s.ok)throw new Error(o.message);y(o.map(c=>c.term)),console.log(o);const d=new Date;let a=o.find(c=>{const h=new Date(c.term_open_date),D=new Date(c.term_close_date);return d>=h&&d<=D});!a&&o.length>0&&(a=[...o].sort((c,h)=>new Date(h.term_close_date)-new Date(c.term_close_date))[0]),a?g(a.term):console.warn("ไม่พบข้อมูลเทอม")}catch(s){f("error",s.message),console.error("Error fetching allRequestExamInfo:",s)}})()},[]);const[E,q]=n.useState([]);n.useEffect(()=>{if(!l)return;console.log(l),(async()=>{try{const s=await fetch(`${S}/api/allRequestThesisProposal`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`},body:JSON.stringify({term:l})}),o=await s.json();if(!s.ok)throw new Error(o.message);q(o),console.log("all request :",o)}catch(s){f("error",s.message),console.error("Error fetching requestExamAll:",s)}})()},[l]);const[_,b]=n.useState(""),i=E.filter(t=>{const s=t.status==="5",o=[t.student_name,t.student_id].join(" ").toLowerCase().includes(_.toLowerCase());return s&&o}),R=()=>{const t=i.map(a=>({รหัสนักศึกษา:a.student_id,"ชื่อ-สกุล":a.student_name,คำขอ:a.request_type,สาขาวิชา:a.major_name,ระดับการศึกษา:a.education_level})),s=p.json_to_sheet(t),o=p.book_new();p.book_append_sheet(o,s,"StudentsData");const d=`รายชื่อผู้มีสิทธิสอบประมวลความรู้_วัดคุณสมบัติ_${l}.xlsx`;A(o,d)};return e.jsxs(C,{children:[e.jsx($,{opened:m.open,onClose:T,message:m.message,type:m.type}),e.jsx(I,{size:"1.5rem",fw:900,mb:"md",children:"พิมพ์ใบรายชื่อผู้มีสิทธิสอบประมวลความรู้/วัดคุณสมบัติ"}),e.jsxs(u,{justify:"space-between",children:[e.jsxs(u,{children:[e.jsx(k,{placeholder:"ค้นหา ชื่่อ รหัส",value:_,onChange:t=>b(t.target.value)}),e.jsx(v,{placeholder:"เทอมการศึกษา",data:w,value:l,allowDeselect:!1,onChange:g})]}),e.jsxs(u,{children:[e.jsx(O,{size:"xs",color:"green",onClick:R,disabled:i.length===0,children:"Export Excel"}),e.jsx(z,{data:i})]})]}),e.jsx(P,{h:"md"}),e.jsx(B,{type:"scroll",offsetScrollbars:!0,style:{borderRadius:"8px",border:"1px solid #e0e0e0"},children:e.jsxs(r,{horizontalSpacing:"sm",verticalSpacing:"sm",highlightOnHover:!0,children:[e.jsx(r.Thead,{children:e.jsxs(r.Tr,{children:[e.jsx(r.Th,{children:"รหัสนักศึกษา"}),e.jsx(r.Th,{children:"ชื่อ"}),e.jsx(r.Th,{children:"คำขอ"})]})}),e.jsx(r.Tbody,{children:i.map(t=>e.jsxs(r.Tr,{children:[e.jsx(r.Td,{children:t.student_id}),e.jsx(r.Td,{children:t.student_name}),e.jsx(r.Td,{children:t.request_type})]},t.request_thesis_proposal_id))})]})})]})};export{W as default};
