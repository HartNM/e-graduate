import{t as g,j as _,L}from"./index-B7_hvkM2.js";import{P as d,f as F,s as z,b as u,d as v,c as q}from"./PdfUtils-2D7kTCyc.js";import{B as P}from"./Button-fInQYk36.js";const D="http://localhost:8080";let U=fetch("/fonts/THSarabunNew Bold.ttf").then(t=>t.arrayBuffer());async function A(t){const s=await d.create();s.registerFontkit(F);const o=s.addPage([595,842]);await z(s);const i=await U,n=await s.embedFont(i),[a,c,p]=u(t?.inspection_date),[x,h,l]=u(t?.advisor_approvals_date),[j,R,k]=u(t?.chairpersons_approvals_date),I={โครงร่างวิทยานิพนธ์:"โครงร่าง",โครงร่างการค้นคว้าอิสระ:"โครงร่าง",วิทยานิพนธ์:"",การค้นคว้าอิสระ:""},m=(t?.request_thesis_type??"").replace("ขอสอบ",""),w=(m??"").replace("โครงร่าง",""),b=I[w],S="ปริญญาเอก";let e=760,r=20;v(o,"แบบฟอร์มรายงานผลการตรวจสอบการคัดลอกผลงานทางวิชาการ",e+40,n,20),v(o,"นักศึกษาระดับบัณฑิตศึกษา มหาวิทยาลัยราชภัฏกำแพงเพชร",e+20,n,20);let f=Number(t?.chapter_1)+Number(t?.chapter_2)+Number(t?.chapter_3)+Number(t?.chapter_4)+Number(t?.chapter_5);t?.chapter_4!==void 0?f=Number(t?.chapter_1)+Number(t?.chapter_2)+Number(t?.chapter_3)+Number(t?.chapter_4)+Number(t?.chapter_5):f=Number(t?.chapter_1)+Number(t?.chapter_2)+Number(t?.chapter_3);let T=t?.chapter_4!==void 0?5:3,C=f/T;[{text:"ข้าพเจ้า ................................................................................................. รหัสประจำตัว .....................................................",x:100,y:e-=r},{text:t?.student_name,x:180,y:e+2},{text:t?.study_group_id,x:420,y:e+2},{text:`นักศึกษาระดับ ${S} สาขาวิชา .................................................................หลักสูตร ${w}`,x:60,y:e-=r},{text:t?.major_name,x:220,y:e+2},{text:`ขอส่งรายงานผลการตรวจสอบความคล้ายคลึงของผลงาน${t?.request_type} (Plagiarism Checking)`,x:100,y:e-=r*2},{text:"ด้วยโปรแกรมอักขราวิสุทธิ์ เพื่อการพิจารณาอนุมัติ",x:60,y:e-=r},{text:`${m}`,x:140,y:e-=r},{text:"บทที่ 1 มีความคล้ายคลึง กับผลงานผู้อื่น ร้อยละ .............................",x:150,y:e-=r},{text:`${t?.chapter_1}%`,x:350,y:e+2},{text:"บทที่ 2 มีความคล้ายคลึง กับผลงานผู้อื่น ร้อยละ .............................",x:150,y:e-=r},{text:`${t?.chapter_2}%`,x:350,y:e+2},{text:"บทที่ 3 มีความคล้ายคลึง กับผลงานผู้อื่น ร้อยละ .............................",x:150,y:e-=r},{text:`${t?.chapter_3}%`,x:350,y:e+2},{text:"บทที่ 4 มีความคล้ายคลึง กับผลงานผู้อื่น ร้อยละ .............................",x:150,y:e-=r,show:t?.chapter_4!==void 0},{text:`${t?.chapter_4}%`,x:350,y:e+2,show:t?.chapter_4!==void 0},{text:"บทที่ 5 มีความคล้ายคลึง กับผลงานผู้อื่น ร้อยละ .............................",x:150,y:e-=r,show:t?.chapter_5!==void 0},{text:`${t?.chapter_5}%`,x:350,y:e+2,show:t?.chapter_5!==void 0},{text:"",x:350,y:e+2,show:t?.chapter_5!==void 0},{text:"รวมความคล้ายคลึงกับผลงานผู้อื่น ร้อยละ ..........................",x:180,y:t?.chapter_4!==void 0?e-=r:e+=r},{text:`${C.toFixed(2)}%`,x:350,y:e+2},{text:"ตรวจสอบเมื่อวันที่ ............... เดือน ......................... พ.ศ. ................",x:150,y:e-=r,show:b===""},{text:a,x:230,y:e+2},{text:c,x:300,y:e+2},{text:p,x:370,y:e+2},{text:"ข้าพเจ้าขอรับรองว่า ผลงานเรื่องที่เสนอข้างต้น มิได้คัดลอกข้อความของผู้อื่น หากมิเป็นความจริง ข้าพเจ้ายินดีให้",x:100,y:b==="โครงร่าง"?e+=r:e-=r},{text:"มหาวิทยาลัยราชภัฏกำแพงเพชรลงโทษตามระเบียบข้อบังคับของมหาวิทยาลัยโดยไม่มีเงื่อนไข",x:60,y:e-=r},{text:"ลงชื่อ...........................................................................",x:310,y:e-=r},{text:t?.student_name,x:370,y:e+2},{text:"(.........................................................................)",x:330,y:e-=r},{text:t?.student_name,x:370,y:e+2},{text:"นักศึกษา",x:400,y:e-=r},{text:"วันที่................/........................../......................",x:330,y:e-=r},{text:a,x:360,y:e+2},{text:c,x:410,y:e+2},{text:p,x:460,y:e+2},{text:"ผลการพิจารณาของประธานที่ปรึกษาการค้นคว้าอิสระ",x:60,y:e-=r},{text:"...............................................................................................................................................................................................................",x:60,y:e-=r},{text:"ลงชื่อ...........................................................................",x:310,y:e-=r},{text:t?.advisor_approvals_name,x:370,y:e+2},{text:"(.........................................................................)",x:330,y:e-=r},{text:t?.advisor_approvals_name,x:370,y:e+2},{text:"อาจารย์ที่ปรึกษา",x:385,y:e-=r},{text:"วันที่................/........................../......................",x:330,y:e-=r},{text:x,x:360,y:e+2},{text:h,x:410,y:e+2},{text:l,x:460,y:e+2},{text:"ผลการพิจารณาตรวจสอบของประธานคณะกรรมการบัณฑิตศึกษาประจำสาขา",x:60,y:e-=r},{text:"...............................................................................................................................................................................................................",x:60,y:e-=r},{text:"ลงชื่อ...........................................................................",x:310,y:e-=r},{text:t?.chairpersons_approvals_name,x:370,y:e+2},{text:"(.........................................................................)",x:330,y:e-=r},{text:t?.chairpersons_approvals_name,x:370,y:e+2},{text:"ประธานกรรมการบัณฑิตศึกษาประจำสาขาวิชา",x:330,y:e-=r},{text:`ประจำสาขาวิชา${t?.major_name}`,x:330,y:e-=r},{text:"วันที่................/........................../......................",x:330,y:e-=r},{text:j,x:360,y:e+2},{text:R,x:410,y:e+2},{text:k,x:460,y:e+2},{text:"* หมายเหตุ",x:60,y:60,font:n},{text:"1. ให้นักศึกษาแนบผลการตรวจสอบการคัดลอกผลงานทางวิชาการด้วยโปรแกรมอักขราวิสุทธิ์ (Plagiarism Checking Report)",x:60,y:40},{text:"2. แนบแผ่นไฟล์โครงร่างวิทยานิพนธ์/การค้นคว้าอิสระ หรือวิทยานิพนธ์/การค้นคว้าอิสระ ฉบับสมบูรณ์มาด้วย",x:60,y:20}].filter(y=>y.show!==!1).forEach(y=>q(o,y.text,y.x,y.y,y.font,y.size));const E=await s.save();return new Blob([E],{type:"application/pdf"})}const $=`${D}/api`;async function B(t,s){const o=await fetch(t,{headers:s?{Authorization:`Bearer ${s}`}:void 0});if(!o.ok)throw new Error(`โหลดไฟล์ไม่สำเร็จ: ${await o.text()}`);return await o.blob()}async function H(t){const s=await d.create(),o=await Promise.all(t.map(n=>n.arrayBuffer().then(a=>d.load(a))));for(const n of o)(await s.copyPages(n,n.getPageIndices())).forEach(c=>s.addPage(c));const i=await s.save();return new Blob([i],{type:"application/pdf"})}async function N(t){const s=localStorage.getItem("token"),o=t?.plagiarism_report_id;let i;t?.request_thesis_proposal_id?i="proposal":i="defense";const n=await A(t),a=[n];if(o){const[c,p]=await Promise.allSettled([B(`${$}/plagiarism-${i}/${o}/plagiarism-file`,s),B(`${$}/plagiarism-${i}/${o}/full-report-file`,s)]);c.status==="fulfilled"&&a.push(c.value),p.status==="fulfilled"&&a.push(p.value)}return a.length===1?n:await H(a)}function G({data:t,showType:s}){const o=t?.plagiarism_report_id,i=g.useMemo(()=>!!o,[o]),[n,a]=g.useState(!1),c=async()=>{a(!0);try{const x=await N(t),h=URL.createObjectURL(x);window.open(h,"_blank")}catch(x){console.error("handleOpen error:",x),alert(x?.message||"ไม่สามารถเปิดไฟล์ได้")}finally{setTimeout(()=>a(!1),800)}},p=async()=>{a(!0);try{const x=await N(t),h=URL.createObjectURL(x),l=document.createElement("iframe");l.style.display="none",l.src=h,document.body.appendChild(l),l.onload=()=>l.contentWindow?.print()}catch(x){console.error("handlePrint error:",x),alert(x?.message||"ไม่สามารถพิมพ์ไฟล์ได้")}finally{setTimeout(()=>a(!1),2e3)}};return _.jsxs(_.Fragment,{children:[s==="view"?_.jsx(P,{size:"xs",color:"gray",onClick:c,disabled:!i,children:"ข้อมูล"}):_.jsx(P,{size:"xs",color:"blue",onClick:p,disabled:!i,children:"พิมพ์"}),n&&_.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(255,255,255,0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999},children:_.jsx(L,{size:"xl",variant:"dots"})})]})}export{G as P};
