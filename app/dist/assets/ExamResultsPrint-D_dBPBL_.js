import{t as n,j as t,B as E,T as b,D as u,E as D,A as o}from"./index-B7_hvkM2.js";import{P as A}from"./PdfExamResultsPrint-DlwH8fCD.js";import{G as j}from"./Group-dxvsYpX2.js";import{S as B}from"./Space-CyCyKMgB.js";import{B as P}from"./Button-fInQYk36.js";import"./PdfUtils-2D7kTCyc.js";import"./dayjs.min-TNDP4t9g.js";const T="http://localhost:8080",q=()=>{const h=localStorage.getItem("token"),[f,y]=n.useState([]),[S,g]=n.useState([]),[i,m]=n.useState(""),[l,w]=n.useState(""),p=s=>{const[e,r]=s.split("/").map(Number);return r*10+e};return n.useEffect(()=>{(async()=>{try{const e=await fetch(`${T}/api/allRequestExamInfo`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`}}),r=await e.json();if(!e.ok)throw new Error(r.message);g(r.map(a=>a.term));const x=new Date;let c=r.find(a=>{const d=new Date(a.term_open_date),_=new Date(a.term_close_date);return x>=d&&x<=_});!c&&r.length>0&&(c=[...r].sort((a,d)=>new Date(d.term_close_date)-new Date(a.term_close_date))[0]),c&&m(c.term)}catch(e){notify("error",e.message)}try{const e=await fetch(`${T}/api/allExamResultsPrint`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`}}),r=await e.json();if(!e.ok)throw new Error(r.message);y(r)}catch(e){notify("error",e.message)}})()},[]),t.jsxs(E,{children:[t.jsx(b,{size:"1.5rem",fw:900,mb:"md",children:"พิมพ์ผลการสอบประมวลความรู้/สอบวัดคุณสมบัติ"}),t.jsx(j,{justify:"space-between",children:t.jsxs(j,{children:[t.jsx(u,{placeholder:"ชนิดคำขอ",data:["ขอสอบประมวลความรู้","ขอสอบวัดคุณสมบัติ"],value:l,onChange:w}),t.jsx(u,{placeholder:"เทอมการศึกษา",data:S,value:i,onChange:m})]})}),t.jsx(B,{h:"md"}),t.jsx(D,{type:"scroll",offsetScrollbars:!0,style:{borderRadius:"8px",border:"1px solid #e0e0e0"},children:t.jsxs(o,{horizontalSpacing:"sm",verticalSpacing:"sm",highlightOnHover:!0,children:[t.jsx(o.Thead,{children:t.jsxs(o.Tr,{children:[t.jsx(o.Th,{children:"รหัสหมู่เรียน"}),t.jsx(o.Th,{children:"เทอมการศึกษา"}),t.jsx(o.Th,{children:"คำขอ"}),t.jsx(o.Th,{children:"ดำเนินการ"})]})}),t.jsx(o.Tbody,{children:Object.entries(f.filter(s=>(!i||s.term===i)&&(!l||s.request_type===l)).sort((s,e)=>p(e.term)-p(s.term)).reduce((s,e)=>{const r=`${e.study_group_id}-${e.term}`;return s[r]||(s[r]=[]),s[r].push(e),s},{})).map(([s,e])=>t.jsxs(o.Tr,{children:[t.jsx(o.Td,{children:e[0].study_group_id}),t.jsx(o.Td,{children:e[0].term}),t.jsx(o.Td,{children:[...new Set(e.map(r=>r.request_type))].join(", ")}),t.jsx(o.Td,{children:t.jsx(P,{size:"xs",onClick:()=>A(e),children:"พิมพ์"})})]},s))})]})})]})};export{q as default};
