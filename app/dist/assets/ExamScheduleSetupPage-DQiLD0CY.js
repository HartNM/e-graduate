import{t as l,j as t,A as r,B as Q,M as R,v as Y,T as k,E as w}from"./index-B7_hvkM2.js";import{M as O}from"./ModalInform-NNINQB9X.js";import{u as P}from"./use-form-DDBi_7fX.js";import{G as $}from"./Group-dxvsYpX2.js";import{B as m}from"./Button-fInQYk36.js";import{D as x}from"./DatePickerInput-DIAi7llo.js";import{S as j}from"./Space-CyCyKMgB.js";import{F as A}from"./Flex-CXnzITNo.js";/* empty css                    */import"./createReactComponent-DJN_V7q0.js";import"./dayjs.min-TNDP4t9g.js";import"./use-disclosure-f2FIm-Gp.js";const f="http://localhost:8080",X=()=>{const[y,T]=l.useState(!1),[s,p]=l.useState(""),[S,u]=l.useState(!1),K=localStorage.getItem("token"),[E,I]=l.useState([]),[M,i]=l.useState(!1),[b,h]=l.useState(""),[D,g]=l.useState(""),a=P({initialValues:{request_exam_info_id:null,term:"",term_date_range:[null,null],KQ_date_range:[null,null],KQ_exam_date:[null,null],ET_exam_date:null},validate:{term:e=>/^\d+\/\d+$/.test(e.trim())?null:"กรุณากรอกในรูปแบบ เช่น 1/68",term_date_range:e=>!e[0]||!e[1]?"กรุณาระบุช่วงวันเปิด-ปิดภาคเรียน":null,KQ_date_range:e=>!e[0]||!e[1]?"กรุณาระบุช่วงวันเปิด-ปิดยื่นคำร้อง":null,KQ_exam_date:e=>e[0]?a.values.KQ_date_range[1]&&e[0]<a.values.KQ_date_range[1]?"วันที่สอบต้องไม่น้อยกว่าวันปิดยื่นคำร้อง":null:"กรุณาระบุวันที่สอบ",ET_exam_date:e=>e?null:"กรุณาระบุวันที่"}});l.useEffect(()=>{(async()=>{try{const _=await(await fetch(`${f}/api/allRequestExamInfo`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${K}`}})).json();I(_),console.log(_)}catch(n){g("error"),h("เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบ"),i(!0),console.error("Error fetch requestExamInfoAll:",n)}T(!1)})()},[y]);const q=async()=>{const e={add:`${f}/api/addRequestExamInfo`,edit:`${f}/api/editRequestExamInfo`,delete:`${f}/api/deleteRequestExamInfo`},n={request_exam_info_id:a.values.request_exam_info_id,term:a.values.term,ET_exam_date:a.values.ET_exam_date,term_open_date:a.values.term_date_range[0],term_close_date:a.values.term_date_range[1],KQ_open_date:a.values.KQ_date_range[0],KQ_close_date:a.values.KQ_date_range[1],KQ_exam_date:a.values.KQ_exam_date[0],KQ_exam_end_date:a.values.KQ_exam_date[1]},_=JSON.stringify(s==="delete"?{request_exam_info_id:a.values.request_exam_info_id}:n);try{const d=await fetch(e[s],{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${K}`},body:_}),c=await d.json();if(!d.ok)throw new Error(c.message);g("success"),h(c.message),i(!0),T(!0),u(!1)}catch(d){g("error"),h(d.message),i(!0),console.error("Error fetch addRequestExamInfo:",d)}},o=e=>{if(!e)return"";const n=new Date(e),_=String(n.getDate()).padStart(2,"0"),d=String(n.getMonth()+1).padStart(2,"0"),c=n.getFullYear()+543;return`${_}/${d}/${c}`},v=E.map((e,n)=>t.jsxs(r.Tr,{children:[t.jsx(r.Td,{style:{textAlign:"center"},children:e.term}),t.jsxs(r.Td,{children:[o(e.term_open_date)," - ",o(e.term_close_date)]}),t.jsxs(r.Td,{children:[o(e.KQ_open_date)," - ",o(e.KQ_close_date)]}),t.jsxs(r.Td,{children:[o(e.KQ_exam_date),e.KQ_exam_end_date?` - ${o(e.KQ_exam_end_date)}`:""]}),t.jsx(r.Td,{children:o(e.ET_exam_date)}),t.jsx(r.Td,{children:t.jsxs($,{children:[t.jsx(m,{size:"xs",color:"yellow",onClick:()=>{a.setValues({...e,term_date_range:[e.term_open_date,e.term_close_date],KQ_date_range:[e.KQ_open_date,e.KQ_close_date],KQ_exam_date:[e.KQ_exam_date,e.KQ_exam_end_date]}),u(!0),p("edit")},children:"แก้ไข"}),t.jsx(m,{size:"xs",color:"red",onClick:()=>{a.setValues({...e,term_date_range:[e.term_open_date,e.term_close_date],KQ_date_range:[e.KQ_open_date,e.KQ_close_date],KQ_exam_date:[e.KQ_exam_date,e.KQ_exam_end_date]}),u(!0),p("delete")},children:"ลบ"})]})})]},e.request_exam_info_id));return t.jsxs(Q,{children:[t.jsx(O,{opened:M,onClose:()=>i(!1),message:b,type:D}),t.jsx(R,{opened:S,onClose:()=>u(!1),title:"กรอกข้อมูลภาคเรียน",centered:!0,children:t.jsxs("form",{onSubmit:a.onSubmit(q),children:[t.jsx(Y,{label:"ภาคเรียน",...a.getInputProps("term"),disabled:s==="delete"}),t.jsx(x,{type:"range",label:"วันเปิด-ปิดภาคเรียน",firstDayOfWeek:0,valueFormat:"DD MMMM YYYY",...a.getInputProps("term_date_range"),disabled:s==="delete"}),t.jsx(x,{type:"range",label:"วันเปิด-ปิดยื่นคำร้องสอบประมวลความรู้/วัดคุณสมบัติ/ความรู้ทางภาษาอังกฤษ",firstDayOfWeek:0,valueFormat:"DD MMMM YYYY",...a.getInputProps("KQ_date_range"),disabled:s==="delete"}),t.jsx(x,{type:"range",allowSingleDateInRange:!0,label:"วันสอบประมวลความรู้/วัดคุณสมบัติ",firstDayOfWeek:0,valueFormat:"DD MMMM YYYY",minDate:a.values.KQ_date_range[1],...a.getInputProps("KQ_exam_date"),disabled:s==="delete"}),t.jsx(x,{label:"วันสอบความรู้ทางภาษาอังกฤษ",firstDayOfWeek:0,valueFormat:"DD MMMM YYYY",...a.getInputProps("ET_exam_date"),disabled:s==="delete"}),t.jsx(j,{h:"md"}),t.jsx(m,{color:s==="delete"?"red":"green",type:"submit",fullWidth:!0,children:s==="delete"?"ลบ":"บันทึก"})]})}),t.jsx(k,{size:"1.5rem",fw:900,mb:"md",children:"กรอกข้อมูลภาคเรียน"}),t.jsx(j,{h:"xl"}),t.jsx(Q,{children:t.jsx(A,{justify:"flex-end",children:t.jsx(m,{size:"xs",onClick:()=>{a.reset(),u(!0),p("add")},children:"กรอกข้อมูล"})})}),t.jsx(j,{h:"xl"}),t.jsx(w,{type:"scroll",offsetScrollbars:!0,style:{borderRadius:"8px",border:"1px solid #e0e0e0"},children:t.jsxs(r,{horizontalSpacing:"sm",verticalSpacing:"sm",highlightOnHover:!0,children:[t.jsx(r.Thead,{children:t.jsxs(r.Tr,{children:[t.jsx(r.Th,{children:"ภาคเรียน"}),t.jsx(r.Th,{children:"วันเปิด-ปิดภาคเรียน"}),t.jsx(r.Th,{children:"วันเปิด-ปิดการยื่นคำร้องขอสอบประมวลความรู้/สอบวัดคุณสมบัติ/สอบความรู้ทางภาษาอังกฤษ"}),t.jsx(r.Th,{children:"วันสอบประมวลความรู้/สอบวัดคุณสมบัติ"}),t.jsx(r.Th,{children:"วันสอบความรู้ทางภาษาอังกฤษ"}),t.jsx(r.Th,{children:"จัดการ"})]})}),t.jsx(r.Tbody,{children:v})]})})]})};export{X as default};
