import{f as xe,u as ye,ah as mt,a as Be,j as e,B as re,G as gt,t as T,s as Fe,ap as bt,l as jt,aq as xt,ar as yt,as as St,o as Ct,m as ke,n as vt,at as W,au as _t,av as oe,ae as wt,A as P,M as Ot,T as Ee,N as Pt,E as Tt}from"./index-B7_hvkM2.js";import{M as It}from"./ModalInform-NNINQB9X.js";import{u as Dt,a as kt,P as Ae}from"./Pill-B7ktLfj6.js";import{j as Et}from"./index-VWaDGczM.js";import{u as At}from"./use-form-DDBi_7fX.js";import{G as Mt}from"./Group-dxvsYpX2.js";import{B as ne}from"./Button-fInQYk36.js";import{S as be}from"./Space-CyCyKMgB.js";import{F as Bt}from"./Flex-CXnzITNo.js";/* empty css                    */import"./createReactComponent-DJN_V7q0.js";var Re={field:"m_45c4369d"};const Ft={type:"visible"},Se=xe((m,j)=>{const i=ye("PillsInputField",Ft,m),{classNames:x,className:c,style:d,styles:g,unstyled:u,vars:E,type:I,disabled:k,id:_,pointer:C,mod:v,attributes:D,...R}=i,N=Dt(),p=mt(),L=Be({name:"PillsInputField",classes:Re,props:i,className:c,style:d,classNames:x,styles:g,unstyled:u,attributes:D,rootSelector:"field"}),$=k||N?.disabled;return e.jsx(re,{component:"input",ref:gt(j,N?.fieldRef),"data-type":I,disabled:$,mod:[{disabled:$,pointer:C},v],...L("field"),...R,id:p?.inputId||_,"aria-invalid":N?.hasError,"aria-describedby":p?.describedBy,type:"text",onMouseDown:A=>!C&&A.stopPropagation()})});Se.classes=Re;Se.displayName="@mantine/core/PillsInputField";const Rt={size:"sm"},ae=xe((m,j)=>{const i=ye("PillsInput",Rt,m),{children:x,onMouseDown:c,onClick:d,size:g,disabled:u,__staticSelector:E,error:I,variant:k,..._}=i,C=T.useRef(null);return e.jsx(kt,{value:{fieldRef:C,size:g,disabled:u,hasError:!!I,variant:k},children:e.jsx(Fe,{size:g,error:I,variant:k,component:"div",ref:j,"data-no-overflow":!0,onMouseDown:v=>{v.preventDefault(),c?.(v),C.current?.focus()},onClick:v=>{v.preventDefault(),v.currentTarget.closest("fieldset")?.disabled||(C.current?.focus(),d?.(v))},..._,multiline:!0,disabled:u,__staticSelector:E||"PillsInput",withAria:!1,children:x})})});ae.displayName="@mantine/core/PillsInput";ae.Field=Se;function Nt({data:m,value:j}){const i=j.map(c=>c.trim().toLowerCase());return m.reduce((c,d)=>(bt(d)?c.push({group:d.group,items:d.items.filter(g=>i.indexOf(g.value.toLowerCase().trim())===-1)}):i.indexOf(d.value.toLowerCase().trim())===-1&&c.push(d),c),[])}const Lt={maxValues:1/0,withCheckIcon:!0,checkIconPosition:"left",hiddenInputValuesDivider:",",clearSearchOnChange:!0,size:"sm"},Ce=xe((m,j)=>{const i=ye("MultiSelect",Lt,m),{classNames:x,className:c,style:d,styles:g,unstyled:u,vars:E,size:I,value:k,defaultValue:_,onChange:C,onKeyDown:v,variant:D,data:R,dropdownOpened:N,defaultDropdownOpened:p,onDropdownOpen:L,onDropdownClose:$,selectFirstOptionOnChange:A,onOptionSubmit:t,comboboxProps:f,filter:w,limit:M,withScrollArea:s,maxDropdownHeight:o,searchValue:h,defaultSearchValue:r,onSearchChange:l,readOnly:b,disabled:y,onFocus:V,onBlur:U,radius:H,rightSection:ie,rightSectionWidth:le,rightSectionPointerEvents:K,rightSectionProps:G,leftSection:Y,leftSectionWidth:ce,leftSectionPointerEvents:de,leftSectionProps:X,inputContainer:a,inputWrapperOrder:B,withAsterisk:z,labelProps:Z,descriptionProps:Ne,errorProps:Le,wrapperProps:$e,description:Ve,label:ue,error:ve,maxValues:ze,searchable:F,nothingFoundMessage:_e,withCheckIcon:We,checkIconPosition:Ge,hidePickedOptions:qe,withErrorStyles:Je,name:Ue,form:He,id:Ke,clearable:Xe,clearButtonProps:Qe,hiddenInputProps:Ye,placeholder:we,hiddenInputValuesDivider:Ze,required:et,mod:tt,renderOption:st,onRemove:pe,onClear:ot,scrollAreaProps:nt,chevronColor:rt,attributes:ee,clearSearchOnChange:at,...Oe}=i,fe=jt(Ke),he=xt(R),q=yt(he),O=St({opened:N,defaultOpened:p,onDropdownOpen:L,onDropdownClose:()=>{$?.(),O.resetSelectedOption()}}),{styleProps:it,rest:{type:Gt,autoComplete:lt,...ct}}=Ct(Oe),[S,Q]=ke({value:k,defaultValue:_,finalValue:[],onChange:C}),[te,dt]=ke({value:h,defaultValue:r,finalValue:"",onChange:l}),se=n=>{dt(n),O.resetSelectedOption()},me=Be({name:"MultiSelect",classes:{},props:i,classNames:x,styles:g,unstyled:u,attributes:ee}),{resolvedClassNames:Pe,resolvedStyles:Te}=vt({props:i,styles:g,classNames:x}),ut=n=>{v?.(n),n.key===" "&&!F&&(n.preventDefault(),O.toggleDropdown()),n.key==="Backspace"&&te.length===0&&S.length>0&&(pe?.(S[S.length-1]),Q(S.slice(0,S.length-1)))},pt=S.map((n,ge)=>e.jsx(Ae,{withRemoveButton:!b&&!q[n]?.disabled,onRemove:()=>{Q(S.filter(ht=>n!==ht)),pe?.(n)},unstyled:u,disabled:y,...me("pill"),children:q[n]?.label||n},`${n}-${ge}`));T.useEffect(()=>{A&&O.selectFirstOption()},[A,te]);const Ie=e.jsx(W.ClearButton,{...Qe,onClear:()=>{ot?.(),Q([]),se("")}}),ft=Nt({data:he,value:S}),De=Xe&&S.length>0&&!y&&!b;return e.jsxs(e.Fragment,{children:[e.jsxs(W,{store:O,classNames:Pe,styles:Te,unstyled:u,size:I,readOnly:b,__staticSelector:"MultiSelect",attributes:ee,onOptionSubmit:n=>{t?.(n),at&&se(""),O.updateSelectedOptionIndex("selected"),S.includes(q[n].value)?(Q(S.filter(ge=>ge!==q[n].value)),pe?.(q[n].value)):S.length<ze&&Q([...S,q[n].value])},...f,children:[e.jsx(W.DropdownTarget,{children:e.jsx(ae,{...it,__staticSelector:"MultiSelect",classNames:Pe,styles:Te,unstyled:u,size:I,className:c,style:d,variant:D,disabled:y,radius:H,__defaultRightSection:e.jsx(W.Chevron,{size:I,error:ve,unstyled:u,color:rt}),__clearSection:Ie,__clearable:De,rightSection:ie,rightSectionPointerEvents:K||(Ie?"all":"none"),rightSectionWidth:le,rightSectionProps:G,leftSection:Y,leftSectionWidth:ce,leftSectionPointerEvents:de,leftSectionProps:X,inputContainer:a,inputWrapperOrder:B,withAsterisk:z,labelProps:Z,descriptionProps:Ne,errorProps:Le,wrapperProps:$e,description:Ve,label:ue,error:ve,withErrorStyles:Je,__stylesApiProps:{...i,rightSectionPointerEvents:K||(De?"all":"none"),multiline:!0},pointer:!F,onClick:()=>F?O.openDropdown():O.toggleDropdown(),"data-expanded":O.dropdownOpened||void 0,id:fe,required:et,mod:tt,attributes:ee,children:e.jsxs(Ae.Group,{attributes:ee,disabled:y,unstyled:u,...me("pillsList"),children:[pt,e.jsx(W.EventsTarget,{autoComplete:lt,children:e.jsx(ae.Field,{...ct,ref:j,id:fe,placeholder:we,type:!F&&!we?"hidden":"visible",...me("inputField"),unstyled:u,onFocus:n=>{V?.(n),F&&O.openDropdown()},onBlur:n=>{U?.(n),O.closeDropdown(),se("")},onKeyDown:ut,value:te,onChange:n=>{se(n.currentTarget.value),F&&O.openDropdown(),A&&O.selectFirstOption()},disabled:y,readOnly:b||!F,pointer:!F})})]})})}),e.jsx(_t,{data:qe?ft:he,hidden:b||y,filter:w,search:te,limit:M,hiddenWhenEmpty:!_e,withScrollArea:s,maxDropdownHeight:o,filterOptions:F,value:S,checkIconPosition:Ge,withCheckIcon:We,nothingFoundMessage:_e,unstyled:u,labelId:ue?`${fe}-label`:void 0,"aria-label":ue?void 0:Oe["aria-label"],renderOption:st,scrollAreaProps:nt})]}),e.jsx(W.HiddenInput,{name:Ue,valuesDivider:Ze,value:S,form:He,disabled:y,...Ye})]})});Ce.classes={...Fe.classes,...W.classes};Ce.displayName="@mantine/core/MultiSelect";var je,Me;function $t(){if(Me)return je;Me=1;var m="Expected a function",j=NaN,i="[object Symbol]",x=/^\s+|\s+$/g,c=/^[-+]0x[0-9a-f]+$/i,d=/^0b[01]+$/i,g=/^0o[0-7]+$/i,u=parseInt,E=typeof oe=="object"&&oe&&oe.Object===Object&&oe,I=typeof self=="object"&&self&&self.Object===Object&&self,k=E||I||Function("return this")(),_=Object.prototype,C=_.toString,v=Math.max,D=Math.min,R=function(){return k.Date.now()};function N(t,f,w){var M,s,o,h,r,l,b=0,y=!1,V=!1,U=!0;if(typeof t!="function")throw new TypeError(m);f=A(f)||0,p(w)&&(y=!!w.leading,V="maxWait"in w,o=V?v(A(w.maxWait)||0,f):o,U="trailing"in w?!!w.trailing:U);function H(a){var B=M,z=s;return M=s=void 0,b=a,h=t.apply(z,B),h}function ie(a){return b=a,r=setTimeout(G,f),y?H(a):h}function le(a){var B=a-l,z=a-b,Z=f-B;return V?D(Z,o-z):Z}function K(a){var B=a-l,z=a-b;return l===void 0||B>=f||B<0||V&&z>=o}function G(){var a=R();if(K(a))return Y(a);r=setTimeout(G,le(a))}function Y(a){return r=void 0,U&&M?H(a):(M=s=void 0,h)}function ce(){r!==void 0&&clearTimeout(r),b=0,M=l=s=r=void 0}function de(){return r===void 0?h:Y(R())}function X(){var a=R(),B=K(a);if(M=arguments,s=this,l=a,B){if(r===void 0)return ie(l);if(V)return r=setTimeout(G,f),H(l)}return r===void 0&&(r=setTimeout(G,f)),h}return X.cancel=ce,X.flush=de,X}function p(t){var f=typeof t;return!!t&&(f=="object"||f=="function")}function L(t){return!!t&&typeof t=="object"}function $(t){return typeof t=="symbol"||L(t)&&C.call(t)==i}function A(t){if(typeof t=="number")return t;if($(t))return j;if(p(t)){var f=typeof t.valueOf=="function"?t.valueOf():t;t=p(f)?f+"":f}if(typeof t!="string")return t===0?t:+t;t=t.replace(x,"");var w=d.test(t);return w||g.test(t)?u(t.slice(2),w?2:8):c.test(t)?j:+t}return je=N,je}var Vt=$t();const zt=wt(Vt);function Wt({form:m,disabled:j=!1,fullCourses:i}){const[x,c]=T.useState([]),d=T.useCallback(zt(g=>{if(!g)return c(i.slice(0,0));const u=i.filter(E=>(E?.value||"").toLowerCase().includes(g.toLowerCase())||(E?.label||"").toLowerCase().includes(g.toLowerCase())).slice(0,50);c(u)},300),[i]);return e.jsx(Ce,{label:"รหัสวิชาที่ต้องเรียน",searchable:!0,hidePickedOptions:!0,data:x,onSearchChange:d,disabled:j,...m.getInputProps("course_id")})}const J="http://localhost:8080",ss=()=>{const m=localStorage.getItem("token"),j=Et(m);j.role;const i=j.user_id,[x,c]=T.useState({open:!1,type:"",message:""}),d=(s,o)=>c({open:!0,type:s,message:o}),g=()=>c(s=>({...s,open:!1})),[u,E]=T.useState([]),[I,k]=T.useState(!1),[_,C]=T.useState(""),[v,D]=T.useState(!1),[R,N]=T.useState([]),p=At({initialValues:{major_id:"",major_name:"",study_group_id:"",course_id:[]},validate:{study_group_id:s=>s===""||s==null?"กรุณากรอกหมู่เรียน":String(s).length!==7?"หมู่เรียนต้องมีจำนวน 7 ตัวอักษร":null,course_id:s=>s.length>0?null:"กรุณาเลือกรหัสวิชา"}}),[L,$]=T.useState([]);T.useEffect(()=>{(async()=>{try{const r=(await(await fetch("https://mua.kpru.ac.th/FrontEnd_Tabian/apiforall/ListSubjectAll")).json()).map(l=>({value:l.SUBJCODE,label:`${l.SUBJCODE} - ${l.SUBJNAME}`}));console.log(r),$(r)}catch(o){console.error(o)}})()},[]),T.useEffect(()=>{(async()=>{try{const o=await fetch(`${J}/api/allMajorCourseRegistration`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`}}),h=await o.json();if(!o.ok)throw new Error(h.message);E(h);const r=await fetch(`${J}/api/officerGetMajor_id`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({user_id:i})}),l=await r.json();if(!r.ok)throw new Error(l.message);const b=await fetch(`${J}/api/major_idGetMajor_name`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({major_id:l.major_id})}),y=await b.json();if(!b.ok)throw new Error(y.message);p.setValues({major_id:l.major_id,major_name:y.major_name})}catch(o){d("error",o.message),console.log(o)}})(),k(!1)},[I]);const A=()=>{p.setValues({study_group_id:"",course_id:[]}),C("add"),D(!0)},t=s=>{p.setValues(s),C("edit"),D(!0)},f=s=>{p.setValues(s),C("delete"),D(!0)},w=async()=>{const s={add:`${J}/api/addCourseRegistration`,edit:`${J}/api/editCourseRegistration`,delete:`${J}/api/deleteCourseRegistration`};try{const o=await fetch(s[_],{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify(p.values)}),h=await o.json();if(!o.ok)throw new Error(h.message);d("success",h.message),D(!1),k(!0)}catch(o){d("error",o.message),console.log(o)}},M=u.map((s,o)=>e.jsxs(P.Tr,{children:[e.jsx(P.Td,{children:p.values.major_name}),e.jsx(P.Td,{children:s.study_group_id}),e.jsx(P.Td,{style:{whiteSpace:"pre-line",textAlign:"left"},children:s.course_id.map((h,r)=>{const l=L.find(y=>y.value===h),b=l?l.label:h;return e.jsx("div",{children:b},r)})}),e.jsx(P.Td,{children:e.jsxs(Mt,{children:[e.jsx(ne,{color:"green",size:"xs",onClick:()=>t(s),children:"แก้ไข"}),e.jsx(ne,{color:"red",size:"xs",onClick:()=>f(s),children:"ลบ"})]})})]},o));return e.jsxs(re,{children:[e.jsx(It,{opened:x.open,onClose:g,message:x.message,type:x.type}),e.jsx(Ot,{opened:v,onClose:()=>D(!1),title:"กรอกข้อมูลรายวิชาสำหรับสอบประมวลความรู้/สอบวัดคุณสมบัติ",centered:!0,closeOnClickOutside:!1,children:e.jsx(re,{children:e.jsxs("form",{onSubmit:p.onSubmit(w),children:[e.jsxs(Ee,{size:"2xl",fw:800,children:["สาขา",p.values.major_name]}),e.jsx(Pt,{label:"หมู่เรียน",hideControls:!0,disabled:_!=="add",...p.getInputProps("study_group_id")}),e.jsx(Wt,{form:p,disabled:_==="delete",fullCourses:L}),e.jsx(be,{h:"md"}),e.jsx(ne,{color:_==="delete"?"red":"green",type:"submit",fullWidth:!0,children:_==="delete"?"ลบ":"บันทึก"})]})})}),e.jsxs(Ee,{size:"1.5rem",fw:900,mb:"md",children:["กรอกข้อมูลรายวิชา","บังคับ"]}),e.jsx(be,{h:"sm"}),e.jsx(re,{children:e.jsx(Bt,{justify:"flex-end",children:e.jsx(ne,{variant:"filled",onClick:()=>A(),children:"เพิ่มข้อมูล"})})}),e.jsx(be,{h:"sm"}),e.jsx(Tt,{type:"scroll",offsetScrollbars:!0,style:{borderRadius:"8px",border:"1px solid #e0e0e0"},children:e.jsxs(P,{horizontalSpacing:"sm",verticalSpacing:"sm",highlightOnHover:!0,children:[e.jsx(P.Thead,{children:e.jsxs(P.Tr,{children:[e.jsx(P.Th,{children:"สาขา"}),e.jsx(P.Th,{children:"หมู่เรียน"}),e.jsx(P.Th,{children:"รายวิชา"}),e.jsx(P.Th,{children:"การดำเนินการ"})]})}),e.jsx(P.Tbody,{children:M})]})})]})};export{ss as default};
