# .github/workflows/deploy-windows.yml
name: Deploy Frontend to Windows Server

on:
  push:
    branches:
      - main # หรือ master

jobs:
  build-and-deploy:
    # 1. สำคัญมาก: สั่งให้รันบน "ผู้ช่วย" ที่เราเพิ่งติดตั้ง
    runs-on: self-hosted 

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18' # หรือเวอร์ชั่นที่คุณใช้

      - name: Install Dependencies
        # 3. ใช้ shell ของ windows (PowerShell)
        shell: powershell
        run: npm install

      - name: Build Project
        shell: powershell
        run: npm run build
        
      - name: Deploy to Nginx
        shell: powershell
        run: |
          # 4. นี่คือการ Deploy
          # คัดลอกไฟล์จาก 'build' ไปที่ 'C:\nginx\html'
          # /E = คัดลอกทั้งหมด
          # /PURGE = ลบไฟล์เก่าที่ 'html' ที่ไม่มีใน 'build' (ทำให้เหมือนกันเป๊ะ)
          robocopy "build" "C:\Program Files\nginx\html" /E /PURGE
          
          Write-Host "Deployment Complete!"